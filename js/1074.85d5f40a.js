"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[1074],{528:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(9835),a=s(6970);function o(e,t,s,o,i,r){const c=(0,n.up)("PostRenderer");return r.note?((0,n.wg)(),(0,n.j4)(c,{key:0,note:r.note},null,8,["note"])):i.decryptFailed?((0,n.wg)(),(0,n.iD)("span",{key:2,class:"decrypt-failed",onClick:t[1]||(t[1]=(...e)=>r.decrypt&&r.decrypt(...e))},(0,a.zw)(e.$t("Decryption failed")),1)):((0,n.wg)(),(0,n.iD)("span",{key:1,class:"click-to-decrypt",onClick:t[0]||(t[0]=e=>s.clickToDecrypt&&r.decrypt())},(0,a.zw)(e.$t("Click to decrypt")),1))}var i=s(3099),r=s(8500),c=s(4264);const l={name:"EncryptedMessage",components:{PostRenderer:r.Z},props:{message:{type:Object,required:!0},clickToDecrypt:{type:Boolean,default:!1}},setup(){return{app:(0,i.q)()}},data(){return{decryptFailed:!1}},computed:{note(){if(!this.message?.plaintext)return;const e=new c.Z(this.message.id,this.message);return e.content=this.message.plaintext,e}},methods:{async decrypt(){if(!this.message.plaintext)try{const e=this.message.id,t=this.message.author===this.app.myPubkey?this.message.recipient:this.message.author,s=await this.app.decryptMessage(t,this.message.content);this.message.id===e&&this.message.cachePlaintext(s)}catch(e){console.error("Failed to decrypt message",e),this.decryptFailed=!0}}},async mounted(){this.app.activeAccount.canDecrypt()&&await this.decrypt()},watch:{async message(){this.app.activeAccount.canDecrypt()&&await this.decrypt()}}};var p=s(1639);const u=(0,p.Z)(l,[["render",o],["__scopeId","data-v-4b8c32d4"]]),d=u},9010:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(9835),a=s(6970);const o={key:0},i={class:"addon"};function r(e,t,s,r,c,l){const p=(0,n.up)("base-icon");return(0,n.wg)(),(0,n.iD)("div",{class:(0,a.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,n.wg)(),(0,n.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,n.Wm)(p,{icon:"back"})])):(0,n.kq)("",!0),(0,n._)("div",{class:(0,a.C_)({"profile-info":!!e.subline})},[(0,n.WI)(e.$slots,"default",{},(()=>[(0,n._)("h2",null,(0,a.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,n.wg)(),(0,n.iD)("span",o,(0,a.zw)(e.subline),1)):(0,n.kq)("",!0)]))],2),(0,n._)("div",i,[(0,n.WI)(e.$slots,"addon")])],2)}var c=s(7664);const l=(0,n.aZ)({name:"PageHeader",components:{BaseIcon:c.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var p=s(1639);const u=(0,p.Z)(l,[["render",r]]),d=u},1074:(e,t,s)=>{s.r(t),s.d(t,{default:()=>K});var n=s(9835),a=s(1957),o=s(6970);const i=e=>((0,n.dD)("data-v-3db0d1d4"),e=e(),(0,n.Cn)(),e),r={ref:"conversation",class:"conversation"},c=i((()=>(0,n._)("div",{class:"pusher"},null,-1))),l={key:3,class:"placeholder"},p={class:"conversation-reply"};function u(e,t,s,i,u,d){const h=(0,n.up)("UserCard"),m=(0,n.up)("PageHeader"),g=(0,n.up)("ChatMessage"),y=(0,n.up)("q-btn"),b=(0,n.up)("json-viewer"),k=(0,n.up)("UserName"),v=(0,n.up)("MessageEditor");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(m,{"back-button":"",dense:""},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{pubkey:d.counterparty,class:"conversation-header",clickable:""},null,8,["pubkey"])])),_:1}),(0,n._)("div",r,[c,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.conversation,(e=>((0,n.wg)(),(0,n.j4)(g,{key:e.id,message:e},null,8,["message"])))),128)),u.opendata?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(y,{key:0,color:"primary",size:"sm",onClick:t[0]||(t[0]=(0,a.iM)((e=>d.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_down"})),u.opendata?((0,n.wg)(),(0,n.j4)(y,{key:1,color:"primary",size:"sm",onClick:t[1]||(t[1]=(0,a.iM)((e=>d.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_up"})):(0,n.kq)("",!0),u.opendata?((0,n.wg)(),(0,n.j4)(b,{key:2,value:d.conversation,clickable:"",onClick:t[2]||(t[2]=(0,a.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,n.kq)("",!0),d.conversation?.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("p",l,[d.counterparty!==i.app.myPubkey?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,o.zw)(e.$t("This is the beginning of your message history with"))+" ",1),(0,n.Wm)(k,{pubkey:d.counterparty,clickable:""},null,8,["pubkey"]),(0,n.Uk)(". ")],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)(" Keep private notes by sending messages to yourself. ")],64))]))],512),(0,n._)("div",p,[(0,n.Wm)(v,{recipient:d.counterparty,placeholder:e.$t(d.placeholder),onPublish:d.onPublish,autofocus:""},null,8,["recipient","placeholder","onPublish"])])],64)}var d=s(8803),h=s.n(d),m=s(9010),g=s(5198);const y={class:"message-editor"},b={class:"inline-controls"},k={class:"inline-controls-item"},v={class:"controls"},w={class:"controls-submit"};function f(e,t,s,a,o,i){const r=(0,n.up)("AutoSizeTextarea"),c=(0,n.up)("BaseIcon"),l=(0,n.up)("EmojiPicker"),p=(0,n.up)("q-menu"),u=(0,n.up)("q-btn");return(0,n.wg)(),(0,n.iD)("div",y,[(0,n._)("div",{class:"input-section",onClick:t[1]||(t[1]=t=>e.$refs.textarea.focus())},[(0,n.Wm)(r,{modelValue:o.content,"onUpdate:modelValue":t[0]||(t[0]=e=>o.content=e),ref:"textarea",placeholder:s.placeholder,disabled:o.publishing,rows:1,onSubmit:i.publishMessage,"submit-on-enter":""},null,8,["modelValue","placeholder","disabled","onSubmit"]),(0,n._)("div",b,[(0,n._)("div",k,[(0,n.Wm)(c,{icon:"emoji"}),(0,n.Wm)(p,{ref:"menuEmojiPicker"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{onSelect:i.onEmojiSelected},null,8,["onSelect"])])),_:1},512)])])]),(0,n._)("div",v,[(0,n._)("div",w,[(0,n.Wm)(u,{icon:"send",loading:o.publishing,disable:!i.hasContent(),color:"primary",onClick:i.publishMessage,round:""},null,8,["loading","disable","onClick"])])])])}var C=s(7664),_=s(2056),Z=s(3942),M=s(3099),P=s(6166),$=s(1153),q=s(5155);const D={name:"MessageEditor",components:{AutoSizeTextarea:Z.Z,BaseIcon:C.Z,EmojiPicker:_.Z},props:{recipient:{type:String,required:!0},placeholder:{type:String,default:"Message"},autofocus:{type:Boolean,default:!1}},emits:["publish"],data(){return{content:"",publishing:!1}},setup(){return{app:(0,M.q)(),nostr:(0,P.D)()}},methods:{hasContent(){return this.content.trim().length>0},onEmojiSelected(e){e.native&&(this.$refs.menuEmojiPicker.hide(),this.$refs.textarea.insertText(e.native))},focus(){this.$refs.textarea.focus()},reset(){this.content=""},async publishMessage(){this.publishing=!0;const e=await this.app.encryptMessage(this.recipient,this.content);if(!e)return;const t=$.Z.message(this.app.myPubkey,this.recipient,e).build();await this.app.signEvent(t)&&(await this.nostr.publish(t)?(this.reset(),this.$nextTick(this.focus.bind(this)),this.$emit("publish",t)):this.$q.notify({message:(0,q.$t)("Failed to send message"),color:"negative"}),this.publishing=!1)}},mounted(){this.autofocus&&this.$nextTick(this.focus.bind(this))}};var T=s(1639),j=s(6362),B=s(8879),W=s(2857),x=s(9984),S=s.n(x);const z=(0,T.Z)(D,[["render",f],["__scopeId","data-v-3fb0f059"]]),E=z;S()(D,"components",{QMenu:j.Z,QBtn:B.Z,QIcon:W.Z});var F=s(9715);function A(e,t,s,a,o,i){const r=(0,n.up)("EncryptedMessage"),c=(0,n.up)("q-chat-message");return(0,n.wg)(),(0,n.j4)(c,{sent:i.sent,"bg-color":i.sent?"grey-2":"pink-2",stamp:i.createdAt,class:"chat-message"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{message:s.message,"click-to-decrypt":""},null,8,["message"])])),_:1},8,["sent","bg-color","stamp"])}var I=s(528),H=s(2296);const R={name:"ChatMessage",components:{EncryptedMessage:I.Z},props:{message:{type:Object,required:!0}},setup(){return{app:(0,M.q)()}},computed:{sent(){return this.message.author===this.app.myPubkey},createdAt(){return H.Z.formatFromNowLong(this.message.created_at)}}};var U=s(4813);const O=(0,T.Z)(R,[["render",A]]),Q=O;S()(R,"components",{QChatMessage:U.Z});var V=s(3413),Y=s(4520);const N={name:"Conversation",components:{ChatMessage:Q,UserName:F.Z,MessageEditor:E,PageHeader:m.Z,UserCard:g.Z,JsonViewer:h()},data(){return{opendata:!1}},setup(){return{app:(0,M.q)(),messages:(0,V.G)()}},computed:{counterparty(){return(0,Y.FX)(this.$route.params.pubkey)},conversation(){if(this.app.isSignedIn)return this.messages.getConversation(this.app.myPubkey,this.counterparty)},placeholder(){return this.app.myPubkey===this.counterparty?"Jot something down":"Message"}},methods:{openToggle(){this.opendata=!this.opendata},onPublish(){this.markAsRead(),this.scrollToBottom()},markAsRead(){this.app.isSignedIn&&this.counterparty&&this.messages.markAsRead(this.app.myPubkey,this.counterparty)},scrollToBottom(){this.$nextTick((()=>window.scrollTo(0,document.body.scrollHeight)))}},mounted(){this.markAsRead(),this.resizeObserver=new ResizeObserver(this.scrollToBottom.bind(this)),this.resizeObserver.observe(this.$refs.conversation)},unmounted(){this.resizeObserver.disconnect()}},J=(0,T.Z)(N,[["render",u],["__scopeId","data-v-3db0d1d4"]]),K=J;S()(N,"components",{QBtn:B.Z})}}]);