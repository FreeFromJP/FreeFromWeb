"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[1087],{9918:(e,t,i)=>{i.r(t),i.d(t,{default:()=>V});var s=i(9835);const a={key:0,class:"post-editor"};function n(e,t,i,n,o,l){const d=(0,s.up)("q-btn-toggle"),r=(0,s.up)("PageHeader"),c=(0,s.up)("PostEditor"),h=(0,s.up)("Feed",!0),u=(0,s.up)("q-tab-panel"),f=(0,s.up)("q-tab-panels"),p=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(p,null,{default:(0,s.w5)((()=>[(0,s.Wm)(r,{logo:"",class:"page-header"},{addon:(0,s.w5)((()=>[e.availableFeeds.length>1?((0,s.wg)(),(0,s.j4)(d,{key:0,modelValue:e.activeFeed,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeFeed=t),rounded:"","toggle-color":"primary",size:"sm",class:"feed-selector",options:[{value:"following",icon:"group",title:e.$t("Following")},{value:"global",icon:"public",title:e.$t("Global")}]},null,8,["modelValue","options"])):(0,s.kq)("",!0)])),_:1}),e.app.isSignedIn?((0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(c)])):(0,s.kq)("",!0),(0,s.Wm)(f,{modelValue:e.activeFeed,"onUpdate:modelValue":t[1]||(t[1]=t=>e.activeFeed=t),"keep-alive":"",animated:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.availableFeeds,(t=>((0,s.wg)(),(0,s.j4)(u,{key:t,name:t},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{feed:e.feedDef(t),ref_for:!0,ref:t,onLoad:e.onFeedLoaded},null,8,["feed","onLoad"])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])),_:1})}i(9665);var o=i(4586),l=i(8189),d=i(1957),r=i(6970);const c=e=>((0,s.dD)("data-v-0838eef4"),e=e(),(0,s.Cn)(),e),h={class:"kind-checkbox ListRawbox"},u={class:"kind-checkbox-item ListRaw"},f=c((()=>(0,s._)("text",{class:"kind-checkbox-text"}," RAW ",-1))),p={class:"feed"};function m(e,t,i,a,n,o){const l=(0,s.up)("q-btn"),c=(0,s.up)("AsyncLoadButton"),m=(0,s.up)("Thread"),g=(0,s.up)("ListPlaceholder");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",h,[(0,s._)("div",u,[n.raw?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(l,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:t[0]||(t[0]=(0,d.iM)((e=>o.ToggleRaw()),["stop"])),class:"kind-checkbox-btn"})),n.raw?((0,s.wg)(),(0,s.j4)(l,{key:1,color:"primary",round:"",size:"xs",onClick:t[1]||(t[1]=(0,d.iM)((e=>o.ToggleRaw()),["stop"])),icon:"done"})):(0,s.kq)("",!0),f])]),(0,s._)("div",p,[(0,s._)("div",{class:(0,r.C_)(["load-more-container",{"more-available":o.numUnreads}])},[o.numUnreads?((0,s.wg)(),(0,s.j4)(c,{key:0,"load-fn":o.loadNewer,label:e.$t("Load {unread} unread",{unread:o.numUnreads})},null,8,["load-fn","label"])):(0,s.kq)("",!0)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.visible,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e[0].id,thread:e,class:"full-width",raw:n.raw},null,8,["thread","raw"])))),128)),(0,s.Wm)(g,{count:n.visible.length,loading:n.loading},null,8,["count","loading"]),n.visible.length?((0,s.wg)(),(0,s.j4)(c,{key:0,"load-fn":o.loadOlder,autoload:""},null,8,["load-fn"])):(0,s.kq)("",!0)])],64)}var g=i(3027),b=i(2141),w=i(6401),v=i(3099),k=i(6166),y=i(2296),F=i(396);const T=(e,t)=>t[0].createdAt-e[0].createdAt,A=e=>t=>(t.createdAt>e&&(t.createdAt=e),t),_=()=>(new Date).getTime()/1e3,q=25,L={name:"Feed",emits:["load"],components:{ListPlaceholder:w.Z,Thread:b.Z,AsyncLoadButton:g.Z},props:{feed:{type:Object,required:!0}},setup(){return{app:(0,v.q)(),nostr:(0,k.D)()}},data(){return{visible:[],newer:[],older:[],stream:null,loading:!0,recentlyLoaded:!0,raw:!1}},computed:{numUnreads(){return this.recentlyLoaded?0:this.newer.length},timestampNewest(){return this.visible[0]?.[0]?.createdAt},timestampOldest(){return this.visible[this.visible.length-1]?.[0]?.createdAt}},methods:{ToggleRaw(){this.raw=!this.raw},init(){const e="function"===typeof this.feed.filters?this.feed.filters():this.feed.filters;this.stream=this.nostr.stream(e,{subId:`feed:${this.feed.name}`,timeout:3e3}),this.stream.on("init",(e=>{const t="function"===typeof this.feed.data?this.feed.data():this.feed.data||[],i=e.concat(t).filter((e=>this.filterNote(e,this.feed.hideBots))).map(A(_())).map((e=>[e])).sort(T).filter(((e,t,i)=>!t||e[0].id!==i[t-1][0].id));this.visible=i.slice(0,q),this.loading=!1,this.$emit("load",this.feed),setTimeout((()=>this.recentlyLoaded=!1),5e3)})),this.stream.on("update",(e=>{if(this.filterNote(e,this.feed.hideBots))if(e=A(_())(e),e.createdAt>=this.timestampNewest)this.newer.push([e]);else if(e.createdAt>=this.timestampOldest){const t=this.visible.findIndex((t=>t[0].createdAt<=e.createdAt));this.visible.splice(t,0,[e])}}))},reload(){this.stream&&(this.loading=!0,this.stream.close(),this.init())},loadNewer(){this.newer.sort(T),console.log("-----------------"+T);const e=this.newer.concat(this.visible);if(e.length>q){const t=e.splice(q);this.older=t.concat(this.older)}return this.visible=e,this.newer=[],this.recentlyLoaded=!0,setTimeout((()=>this.recentlyLoaded=!1),5e3),!0},async loadOlder(){const e="function"===typeof this.feed.filters?this.feed.filters():this.feed.filters,t=this.timestampOldest||y.Z.now(),i=Object.assign({},e,{until:t});if(this.older.length>=i.limit){const e=this.older.splice(0,i.limit);return this.visible=this.visible.concat(e),e}this.older=[];const s=await this.nostr.fetch(i,{subId:`feed:${this.feed.name}-older`}),a=s.filter((e=>e.createdAt<=t)).filter((e=>this.filterNote(e,this.feed.hideBots))).map((e=>[e])).sort(T);return this.visible=this.visible.concat(a),a},filterNote(e,t){return!e.isReaction()&&(!e.isRepostOrTag()&&(!t||!e.relatedPubkeys().some(F.Z.isBot)))},aunique(e,t){const i=new Set;if(!t)return e.reduce(((e,s)=>{let a=null;return a="string"===typeof t&&t?s[t]:"object"===typeof s?JSON.stringify(s):s,i.has(a)||(i.add(a),e.push(s)),e}),[])}},mounted(){this.init()},unmounted(){this.stream&&this.stream.close()}};var Z=i(1639),P=i(8879),D=i(9984),N=i.n(D);const O=(0,Z.Z)(L,[["render",m],["__scopeId","data-v-0838eef4"]]),j=O;N()(L,"components",{QBtn:P.Z});var B=i(7498),x=i(4132);const C="0000000000000000000000000000000000000000000000000000000000000000",I=()=>{const e=(0,v.q)(),t=(0,k.D)(),i=t.getContacts(e.myPubkey);return i?.map((e=>e.pubkey)).concat(e.myPubkey)},R={global:{name:"global",filters:{kinds:[B.nS.NOTE],limit:20},hideBots:!0},following:{name:"following",filters:()=>{let e=I();return e&&e.length||(e=[C]),{kinds:[B.nS.NOTE],authors:e,limit:50}},data:()=>{let e=I();if(!e||!e.length)return[];let t=[];const i=(0,x.d)();for(const s of e)t=t.concat(i.postsByAuthor(s,x.i.CREATION_DATE_DESC));return t},hideBots:!1}},S=(0,s.aZ)({name:"FeedPage",components:{PageHeader:o.Z,PostEditor:l.Z,Feed:j},setup(){return{app:(0,v.q)(),nostr:(0,k.D)()}},data(){return{feeds:{},activeFeed:this.app.isSignedIn?"following":"global",initialized:!1}},computed:{availableFeeds(){const e=[];return this.app.isSignedIn&&e.push("following"),e.push("global"),e},contacts(){if(this.app.isSignedIn)return this.nostr.getContacts(this.app.myPubkey)}},methods:{feedDef(e){return R[e]},initFeed(){this.initialized||this.contacts&&(this.initialized=!0,this.activeFeed=this.contacts?.length?"following":"global")},onFeedLoaded(e){"following"!==this.activeFeed||e?.name!==this.activeFeed||this.contacts?.length||this.initialized||(this.initialized=!0)}},watch:{contacts(){this.initFeed(),this.$refs.following?.[0]?.reload()}},mounted(){this.initFeed()}});var z=i(9885),W=i(8983),E=i(4016),$=i(4106);const U=(0,Z.Z)(S,[["render",n],["__scopeId","data-v-636738e0"]]),V=U;N()(S,"components",{QPage:z.Z,QBtnToggle:W.Z,QTabPanels:E.Z,QTabPanel:$.Z})}}]);