"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[1234],{8042:(e,t,s)=>{s.r(t),s.d(t,{default:()=>be});var o=s(9835),i=s(1957),n=s(6970);const l=e=>((0,o.dD)("data-v-d8c68528"),e=e(),(0,o.Cn)(),e),a={class:"Traffic-page"},c={class:"kind-checkbox"},r={class:"kind-checkbox-item"},u={key:2,class:"kind-checkbox-text"},d=["onUpdate:modelValue"],p={key:0,class:"following"},h={class:"following-wrapper"},k={class:"following-header"},y=l((()=>(0,o._)("h3",null,"Profile List",-1))),g={class:"following-body"},m=l((()=>(0,o._)("div",{class:"following-gradient"},null,-1))),b={key:1,class:"kind-checkbox ListRawbox"},w={class:"kind-checkbox-item ListRaw"},f=l((()=>(0,o._)("text",{class:"kind-checkbox-text"}," RAW ",-1))),v={class:"post"},x={key:0,class:"post-author"};function q(e,t,s,l,q,C){const _=(0,o.up)("PageHeader"),D=(0,o.up)("q-btn"),Z=(0,o.up)("SearchBox"),T=(0,o.up)("UserCard"),U=(0,o.up)("UserAvatar"),M=(0,o.up)("UserName"),B=(0,o.up)("json-viewer"),L=(0,o.up)("Thread"),P=(0,o.up)("ListPlaceholder");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(_,{"back-button":""}),(0,o._)("div",a,[(0,o._)("div",c,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(q.kindlist,((e,t)=>((0,o.wg)(),(0,o.iD)("div",r,[e.check?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(D,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:(0,i.iM)((s=>C.pushKind(e.type,t)),["stop"]),class:"kind-checkbox-btn"},null,8,["onClick"])),e.check?((0,o.wg)(),(0,o.j4)(D,{key:1,color:"primary",round:"",size:"xs",onClick:(0,i.iM)((s=>C.delKind(e.type,t)),["stop"]),icon:"done"},null,8,["onClick"])):(0,o.kq)("",!0),e.name?((0,o.wg)(),(0,o.iD)("text",u,(0,n.zw)(e.name)+"="+(0,n.zw)(e.type),1)):(0,o.kq)("",!0),e.name?(0,o.kq)("",!0):(0,o.wy)(((0,o.wg)(),(0,o.iD)("input",{key:3,placeholder:"自定义输入","onUpdate:modelValue":t=>e.type=t,class:"zdyinput"},null,8,d)),[[i.nr,e.type]])])))),256))]),(0,o.Wm)(Z),(0,o.Wm)(D,{color:"primary",size:"md",onClick:t[0]||(t[0]=(0,i.iM)((e=>C.getProfile()),["stop"])),label:"Search",disabled:q.kinds.length<1,class:"qbtn-style"},null,8,["disabled"]),l.app.isSignedIn&&C.contacts?.length?((0,o.wg)(),(0,o.iD)("div",p,[(0,o._)("div",h,[(0,o._)("div",k,[q.Expansion?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(D,{key:0,color:"primary",size:"sm",onClick:t[1]||(t[1]=(0,i.iM)((e=>C.openToggle()),["stop"])),label:"Expansion",class:"qbtn-header-style","icon-right":"arrow_drop_down",outline:"",rounded:""})),q.Expansion?((0,o.wg)(),(0,o.j4)(D,{key:1,color:"primary",size:"sm",onClick:t[2]||(t[2]=(0,i.iM)((e=>C.openToggle()),["stop"])),label:"Put away",class:"qbtn-header-style","icon-right":"arrow_drop_up",outline:"",rounded:""})):(0,o.kq)("",!0),y]),(0,o.wy)((0,o._)("div",g,[((0,o.wg)(),(0,o.j4)(T,{key:l.app.myPubkey,pubkey:l.app.myPubkey,class:"following-body-item",clickable:""},null,8,["pubkey"])),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(C.contacts,(e=>((0,o.wg)(),(0,o.j4)(T,{key:e.pubkey,pubkey:e.pubkey,class:"following-body-item",clickable:""},null,8,["pubkey"])))),128))],512),[[i.F8,q.Expansion]]),m])])):(0,o.kq)("",!0),q.visible.length?((0,o.wg)(),(0,o.iD)("div",b,[(0,o._)("div",w,[q.raw?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(D,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:t[3]||(t[3]=(0,i.iM)((e=>C.ToggleRaw()),["stop"])),class:"kind-checkbox-btn"})),q.raw?((0,o.wg)(),(0,o.j4)(D,{key:1,color:"primary",round:"",size:"xs",onClick:t[4]||(t[4]=(0,i.iM)((e=>C.ToggleRaw()),["stop"])),icon:"done"})):(0,o.kq)("",!0),f])])):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(q.notelist,(e=>((0,o.wg)(),(0,o.iD)("div",v,[e.author?((0,o.wg)(),(0,o.iD)("div",x,[(0,o.Wm)(U,{pubkey:e.author,clickable:"",onClick:t[5]||(t[5]=(0,i.iM)((()=>{}),["stop"]))},null,8,["pubkey"]),(0,o.Uk)("   "),(0,o.Wm)(M,{pubkey:e.author,clickable:"",onClick:t[6]||(t[6]=(0,i.iM)((()=>{}),["stop"]))},null,8,["pubkey"]),(0,o.Uk)("   ")])):(0,o.kq)("",!0),(0,o.Wm)(B,{value:e,clickable:"",onClick:t[7]||(t[7]=(0,i.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])])))),256)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(q.visible,(e=>((0,o.wg)(),(0,o.j4)(L,{key:e[0].id,thread:e,raw:q.raw,ref_for:!0,ref:"Threadref",class:"full-width"},null,8,["thread","raw"])))),128)),(0,o.Wm)(P,{count:q.visible.length,loading:q.loading},null,8,["count","loading"])])],64)}s(9665);var C=s(3027),_=s(5501),D=s(9715),Z=s(8803),T=s.n(Z),U=s(6401);const M={class:"user-card"};function B(e,t,s,n,l,a){const c=(0,o.up)("q-btn"),r=(0,o.up)("UserAvatar"),u=(0,o.up)("UserName");return(0,o.wg)(),(0,o.iD)("div",M,[l.check?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:t[0]||(t[0]=(0,i.iM)((e=>a.getpubkeyToggle(s.pubkey)),["stop"]))})),l.check?((0,o.wg)(),(0,o.j4)(c,{key:1,color:"primary",round:"",size:"xs",onClick:t[1]||(t[1]=(0,i.iM)((e=>a.Toggle(s.pubkey)),["stop"])),icon:"done"})):(0,o.kq)("",!0),(0,o.Wm)(r,{pubkey:s.pubkey,clickable:s.clickable},null,8,["pubkey","clickable"]),(0,o.Wm)(u,{pubkey:s.pubkey,clickable:s.clickable,class:"username","two-line":"","show-verified":""},null,8,["pubkey","clickable"])])}var L=s(7328);const P={name:"UserCard",components:{FollowButton:L.Z,UserName:D.Z,UserAvatar:_.Z},props:{pubkey:{type:String,required:!0},clickable:{type:Boolean,default:!1},followButton:{type:Boolean,default:!1}},data(){return{check:!1}},methods:{getpubkeyToggle(e){console.log("pubkey----",e),this.check=!0,this.$parent.getchildpub(e)},Toggle(e){this.check=!1,this.$parent.delchildpub(e)}}};var A=s(1639),R=s(8879),j=s(9984),F=s.n(j);const W=(0,A.Z)(P,[["render",B],["__scopeId","data-v-3b74a8bc"]]),E=W;F()(P,"components",{QBtn:R.Z});var K=s(6166),z=s(3099),N=s(2187),S=s(2929);const H={class:"relative-position"},I={class:"searchbox-wrapper"},$={class:"searchbox-icon"},Y={class:"searchbox-input"},O=["placeholder"],V={key:0,class:"searchbox-results"},Q={key:0,class:"query-example"},J=(0,o._)("b",null,"npub…",-1),G=(0,o._)("b",null,"[user]@domain",-1),X=(0,o._)("b",null,"name",-1);function ee(e,t,s,l,a,c){const r=(0,o.up)("BaseIcon"),u=(0,o.up)("q-form"),d=(0,o.up)("UserCard");return(0,o.wg)(),(0,o.iD)("div",H,[(0,o._)("div",{class:(0,n.C_)(["searchbox",{focused:a.focused}])},[(0,o._)("div",I,[(0,o._)("div",$,[(0,o.Wm)(r,{icon:"search"})]),(0,o._)("div",Y,[(0,o.Wm)(u,{onSubmit:(0,i.iM)(c.search,["stop"])},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.query=e),ref:"input",type:"text",placeholder:e.$t("Search profiles"),onFocus:t[1]||(t[1]=(...e)=>c.toggleFocus&&c.toggleFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>c.toggleFocus&&c.toggleFocus(...e)),onKeyup:[t[3]||(t[3]=(...e)=>c.search&&c.search(...e)),t[4]||(t[4]=(0,i.D2)((t=>e.$refs.input.blur()),["esc"]))]},null,40,O),[[i.nr,a.query]])])),_:1},8,["onSubmit"])])])],2),(0,o.Wm)(i.uT,{name:"fade"},{default:(0,o.w5)((()=>[a.focused?((0,o.wg)(),(0,o.iD)("div",V,[a.results.length?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Q,[J,(0,o.Uk)(" or "),G,(0,o.Uk)(" or "),X])),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.results,(e=>((0,o.wg)(),(0,o.j4)(d,{key:e,pubkey:e,class:"searchbox-results-item",clickable:"",onMousedown:t=>c.getpub(e)},null,8,["pubkey","onMousedown"])))),128))])):(0,o.kq)("",!0)])),_:1})])}var te=s(7664),se=s(7175),oe=s(5198);const ie={name:"SearchBox",mixins:[S.Z],components:{UserCard:oe.Z,BaseIcon:te.Z},setup(){return{provider:new se.Z}},data(){return{focused:!1,query:"",results:[]}},methods:{toggleFocus(){this.focused=!this.focused},getpub(e){this.$parent.Searchchildpub(e)},async search(){this.query?this.results=(await this.provider.queryProfiles(this.query)).slice(0,200):this.results=[]}}};var ne=s(8326);const le=(0,A.Z)(ie,[["render",ee]]),ae=le;F()(ie,"components",{QForm:ne.Z});var ce=s(9010),re=s(4520),ue=(s(7498),s(2296)),de=s(384);const pe=(e,t)=>t[0].createdAt-e[0].createdAt,he=e=>t=>(t.createdAt>e&&(t.createdAt=e),t),ke=()=>(new Date).getTime()/1e3,ye=25,ge={name:"FollowingBox",components:{UserCard:E,SearchBox:ae,PageHeader:ce.Z,Thread:de.Z,ListPlaceholder:U.Z,JsonViewer:T(),UserAvatar:_.Z,UserName:D.Z,AsyncLoadButton:C.Z},mixins:[S.Z],data(){return{visible:[],hideBots:!1,pubkeyList:[],recentlyLoaded:!0,newer:[],older:[],loading:!1,Expansion:!1,kinds:[],notelist:[],kindlist:[{name:"Metadata",type:0,check:!1},{name:"Text",type:1,check:!1},{name:"RecommendRelay",type:2,check:!1},{name:"Contacts",type:3,check:!1},{name:"EncryptedDirectMessage",type:4,check:!1},{name:"EventDeletion",type:5,check:!1},{name:"Reposts",type:6,check:!1},{name:"Reaction",type:7,check:!1},{name:"Badge Award",type:8,check:!1},{name:"ChannelCreation",type:40,check:!1},{name:"ChannelMetadata",type:41,check:!1},{name:"ChannelMessage",type:42,check:!1},{name:"ChannelHideMessage",type:43,check:!1},{name:"ChannelMuteUser",type:44,check:!1},{name:"Report",type:1984,check:!1},{name:"ZapRequest",type:9734,check:!1},{name:"Zap",type:9735,check:!1},{name:"RelayList",type:10002,check:!1},{name:"ClientAuth",type:22242,check:!1},{name:"Article",type:30023,check:!1},{name:"",type:"",check:!1},{name:"",type:"",check:!1},{name:"",type:"",check:!1},{name:"",type:"",check:!1}],raw:!1}},setup(){return{app:(0,z.q)(),nostr:(0,K.D)()}},computed:{numUnreads(){return this.recentlyLoaded?0:this.newer.length},pubkey(){return this.app.myPubkey},contacts(){return this.nostr.getContacts(this.pubkey)?.slice(0,20)}},methods:{formatPostDate(e){const t=this.$q.screen.lt.md?"short":"long";return ue.Z.formatFromNow(e,t)},ToggleRaw(){this.raw=!this.raw},pushKind(e,t){0===e||e?(this.kindlist[t].check=!0,this.kinds.push(e)):this.$q.notify({message:"No Kinds",color:"negative"})},delKind(e,t){if(0===e||e){this.kindlist[t].check=!1;const s=this.kinds;s.forEach(((t,o)=>{t==e&&(s.splice(o,1),this.kinds=s)}))}else this.$q.notify({message:"No Kinds",color:"negative"})},openToggle(){this.Expansion=!this.Expansion},getchildpub(e){this.pubkeyList.push(e)},delchildpub(e){const t=this.pubkeyList;t.forEach(((s,o)=>{s==e&&(t.splice(o,1),this.pubkeyList=t)}))},Searchchildpub(e){this.pubkeyList=[],this.pubkeyList.push(e),this.kinds?this.getProfile():this.$q.notify({message:"No Kinds",color:"negative"})},filterNote(e,t){return!e.isReaction()&&!e.isRepostOrTag()},ensureBech32(e,t){return(0,re.iY)(e)?e:(0,re.jm)(e,t)},filters(){console.log("kindskindskindskindskinds-----filters",this.kinds);let e=this.pubkeyList,t=this.kinds;return e&&e.length||(e=[]),e&&e.length?{kinds:t,authors:e}:(console.log("走这里"),{kinds:t})},followingdata(){let e=this.pubkeyList;if(!e||!e.length)return[];let t=[];const s=(0,N.d)();for(const o of e)t=t.concat(s.postsByAuthor(o,N.i.CREATION_DATE_DESC));return t},loadOlder(){console.log("loadOlder-*-*-*------*-*-*-*-*-*-*-*-*---*-")},loadNewer(){console.log("loadOlder-*-*-*------*-*-*-*-*-*-*-*-*---*-")},empty(){this.visible=""},reload(){this.loading=!0,this.getProfile()},async getProfile(){this.visible=[],this.notelist=[],this.loading=!0;const e=this.filters(),t=this.kinds;if(console.log("构造的filter为-----------------",e),1===t.length&&1==t[0])this.stream=this.nostr.stream(e,{subId:"",timeout:3e3}),this.stream.on("init",(e=>{const t=e.filter((e=>this.filterNote(e,this.hideBots))).map(he(ke())).map((e=>[e])).sort(pe).filter(((e,t,s)=>!t||e[0].id!==s[t-1][0].id));this.visible=t.slice(0,ye),this.loading=!1})),e.authors?(console.log("选取了指定人员执行动态拉取"),this.stream.on("update",(e=>{this.getProfile()}))):console.log("未指定对象，不进行动态加载");else{const t=await this.nostr.fetch(e,{subId:""});this.notelist=t.slice(0,ye),this.loading=!1,this.stream=this.nostr.stream(e,{subId:""}),e.authors?(console.log("选取了指定人员执行动态拉取"),this.stream.on("update",(e=>{this.getProfile()}))):console.log("未指定对象，不进行动态加载")}}}},me=(0,A.Z)(ge,[["render",q],["__scopeId","data-v-d8c68528"]]),be=me;F()(ge,"components",{QBtn:R.Z})}}]);