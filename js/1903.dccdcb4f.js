"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[1903],{396:(e,t,o)=>{o.d(t,{Z:()=>r});var s=o(4520);const n=new Set,r=n;n.isBot=n.has.bind(n),n.add=e=>Set.prototype.add.call(n,(0,s.FX)(e))},6401:(e,t,o)=>{o.d(t,{Z:()=>g});var s=o(9835),n=o(6970);const r={key:0,class:"list-placeholder"},a={key:1};function i(e,t,o,i,l,c){const u=(0,s.up)("q-spinner");return o.count?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",r,[o.loading?((0,s.wg)(),(0,s.j4)(u,{key:0,size:"sm"})):((0,s.wg)(),(0,s.iD)("p",a,(0,n.zw)(e.$t(o.label)),1))]))}const l={name:"ListPlaceholder",props:{count:{type:Number,default:0},loading:{type:Boolean,default:!1},label:{type:String,default:"Nothing here."}}};var c=o(1639),u=o(3940),d=o(9984),h=o.n(d);const p=(0,c.Z)(l,[["render",i],["__scopeId","data-v-fdc49960"]]),g=p;h()(l,"components",{QSpinner:u.Z})},9010:(e,t,o)=>{o.d(t,{Z:()=>h});var s=o(9835),n=o(6970);const r={key:0},a={class:"addon"};function i(e,t,o,i,l,c){const u=(0,s.up)("base-icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,s.Wm)(u,{icon:"back"})])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,n.C_)({"profile-info":!!e.subline})},[(0,s.WI)(e.$slots,"default",{},(()=>[(0,s._)("h2",null,(0,n.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,s.wg)(),(0,s.iD)("span",r,(0,n.zw)(e.subline),1)):(0,s.kq)("",!0)]))],2),(0,s._)("div",a,[(0,s.WI)(e.$slots,"addon")])],2)}var l=o(7664);const c=(0,s.aZ)({name:"PageHeader",components:{BaseIcon:l.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var u=o(1639);const d=(0,u.Z)(c,[["render",i]]),h=d},2141:(e,t,o)=>{o.d(t,{Z:()=>u});var s=o(9835);const n={class:"thread"};function r(e,t,o,r,a,i){const l=(0,s.up)("ListPost");return(0,s.wg)(),(0,s.iD)("div",n,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.filteredThread,((e,t)=>((0,s.wg)(),(0,s.j4)(l,{key:e.id,note:e,"connector-top":i.filteredThread.length>1&&t>0,"connector-bottom":i.filteredThread.length>1&&t<i.filteredThread.length-1||o.forceBottomConnector,actions:"",clickable:"",raw:o.raw},null,8,["note","connector-top","connector-bottom","raw"])))),128))])}var a=o(1459);const i={name:"Thread",components:{ListPost:a.Z},props:{thread:{type:Array,required:!0},forceBottomConnector:{type:Boolean,default:!1},raw:Boolean},setup(e){(0,s.YP)((()=>e.raw),(e=>{}))},computed:{filteredThread(){return this.thread.filter((e=>!!e))}}};var l=o(1639);const c=(0,l.Z)(i,[["render",r],["__scopeId","data-v-44d236ba"]]),u=c},7814:(e,t,o)=>{o.r(t),o.d(t,{default:()=>$});var s=o(9835),n=o(6970),r=o(1957);const a={class:"relative-position"},i={class:"searchbox-wrapper"},l={class:"searchbox-icon"},c={class:"searchbox-input"},u={key:0,class:"searchbox-results"},d={key:0,class:"query-example"},h=(0,s._)("b",null,"npub",-1),p=(0,s._)("b",null,"eventID",-1);function g(e,t,o,g,b,f){const m=(0,s.up)("PageHeader"),v=(0,s.up)("BaseIcon"),w=(0,s.up)("q-form"),y=(0,s.up)("UserCard"),k=(0,s.up)("Thread"),Z=(0,s.up)("json-viewer"),_=(0,s.up)("ListPlaceholder");return(0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(m,{"back-button":""}),(0,s._)("div",{class:(0,n.C_)(["searchbox",{focused:b.focused}])},[(0,s._)("div",i,[(0,s._)("div",l,[(0,s.Wm)(v,{icon:"search"})]),(0,s._)("div",c,[(0,s.Wm)(w,{onSubmit:(0,r.iM)(f.search,["stop"])},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>b.filters.search=e),ref:"input",type:"text",placeholder:"Search eventID or npub",onFocus:t[1]||(t[1]=(...e)=>f.toggleFocus&&f.toggleFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>f.toggleFocus&&f.toggleFocus(...e)),onKeyup:[t[3]||(t[3]=(...e)=>f.search&&f.search(...e)),t[4]||(t[4]=(0,r.D2)((t=>e.$refs.input.blur()),["esc"]))]},null,544),[[r.nr,b.filters.search]])])),_:1},8,["onSubmit"])])])],2),(0,s.Wm)(r.uT,{name:"fade"},{default:(0,s.w5)((()=>[b.focusednpub?((0,s.wg)(),(0,s.iD)("div",u,[b.results.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",d,[h,(0,s.Uk)(" or "),p])),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(b.results,(t=>((0,s.wg)(),(0,s.j4)(y,{key:t,pubkey:t,class:"searchbox-results-item",clickable:"",onMousedown:o=>e.goToProfile(t)},null,8,["pubkey","onMousedown"])))),128))])):(0,s.kq)("",!0)])),_:1}),(0,s.Wm)(k,{thread:b.visible,"force-bottom-connector":"",class:"ancestors"},null,8,["thread"]),b.jsonnote.length>0?((0,s.wg)(),(0,s.j4)(Z,{key:0,value:b.jsonnote,clickable:"",onClick:t[5]||(t[5]=(0,r.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,s.kq)("",!0),(0,s.Wm)(_,{count:b.visible.length||b.jsonnote.length,loading:b.loading},null,8,["count","loading"])])}o(9665);var b=o(8803),f=o.n(b),m=o(5501),v=o(9715),w=o(8500),y=o(6401),k=o(7664),Z=o(7175),_=o(5198),B=o(2929),C=o(3099),D=o(6166),T=(o(7498),o(2187)),P=o(396),A=(o(2296),o(9010)),F=o(4520),j=o(2141);const q=()=>{const e=(0,C.q)(),t=(0,D.D)(),o=t.getContacts(e.myPubkey);return o?.map((e=>e.pubkey)).concat(e.myPubkey)},I={name:"SearchBox",mixins:[B.Z],components:{UserCard:_.Z,BaseIcon:k.Z,PageHeader:A.Z,ListPlaceholder:y.Z,PostRenderer:w.Z,UserAvatar:m.Z,UserName:v.Z,JsonViewer:f(),Thread:j.Z},setup(){return{app:(0,C.q)(),nostr:(0,D.D)(),provider:new Z.Z}},data(){return{visible:[],focused:!1,focusednpub:!1,loading:!1,query:"",results:[],hideBots:!0,jsonnote:[],filters:{search:""}}},computed:{timestampOldest(){return this.results[this.results.length-1]?.[0]?.createdAt}},methods:{toggleFocus(){this.focused=!this.focused},filterNote(e,t){return!e.isReaction()&&(!e.isRepostOrTag()&&(!t||!e.relatedPubkeys().some(P.Z.isBot)))},datas(){let e=q();if(!e||!e.length)return[];let t=[];const o=(0,T.d)();for(const s of e)t=t.concat(o.postsByAuthor(s,T.i.CREATION_DATE_DESC));return t},allAncestors(e){if(!e.hasAncestor())return[];const t=this.nostr.getNote(e.ancestor());return t?this.allAncestors(t).concat([t]):(console.error(`Couldn't fetch ancestor ${e.ancestor()}`),[])},collectPredecessors(e,t){if(!e||!e.length)return[];const o=e.pop(),s=this.nostr.getRepliesTo(o.id,T.i.CREATION_DATE_ASC),n=s.findIndex((e=>e.id===t.id)),r=[o].concat(s.slice(0,n));return this.collectPredecessors(e,o).concat(r)},async search(){if(this.filters.search){this.visible=[],this.loading=!0;var e=this.filters.search;const t=e.match(/note[a-zA-Z0-9]{59,60}/gi),o=e.match(/npub[a-zA-Z0-9]{59,60}/gi);if(t){this.visible=[],this.jsonnote=[];const e=(0,F.FX)(t[0]),o=this.nostr.getNote(e);console.log("searchnotes=+++++++++++++++1",o),this.visible.push(o)}else if(o)console.log("npubMatch触发"),this.focusednpub=!0,this.results=(await this.provider.queryProfiles(this.filters.search)).slice(0,200);else{const t={ids:[e]},o=await this.nostr.fetch(t);console.log("notes****************",o),o?(this.visible=[],this.jsonnote=[],1==o[0].kind?this.visible=o:this.jsonnote=o):(this.visible=[],this.jsonnote=[])}this.loading=!1}else this.focusednpub=!1,this.results=[]}}};var S=o(1639),x=o(8326),W=o(9984),N=o.n(W);const R=(0,S.Z)(I,[["render",g]]),$=R;N()(I,"components",{QForm:x.Z})}}]);