"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[2951],{1074:(e,s,t)=>{t.r(s),t.d(s,{default:()=>K});var n=t(9835),o=t(1957),a=t(6970);const i=e=>((0,n.dD)("data-v-3db0d1d4"),e=e(),(0,n.Cn)(),e),r={ref:"conversation",class:"conversation"},c=i((()=>(0,n._)("div",{class:"pusher"},null,-1))),l={key:3,class:"placeholder"},u={class:"conversation-reply"};function p(e,s,t,i,p,d){const h=(0,n.up)("UserCard"),m=(0,n.up)("PageHeader"),g=(0,n.up)("ChatMessage"),b=(0,n.up)("q-btn"),y=(0,n.up)("json-viewer"),k=(0,n.up)("UserName"),v=(0,n.up)("MessageEditor");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(m,{"back-button":"",dense:""},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{pubkey:d.counterparty,class:"conversation-header",clickable:""},null,8,["pubkey"])])),_:1}),(0,n._)("div",r,[c,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.conversation,(e=>((0,n.wg)(),(0,n.j4)(g,{key:e.id,message:e},null,8,["message"])))),128)),p.opendata?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(b,{key:0,color:"primary",size:"sm",onClick:s[0]||(s[0]=(0,o.iM)((e=>d.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_down"})),p.opendata?((0,n.wg)(),(0,n.j4)(b,{key:1,color:"primary",size:"sm",onClick:s[1]||(s[1]=(0,o.iM)((e=>d.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_up"})):(0,n.kq)("",!0),p.opendata?((0,n.wg)(),(0,n.j4)(y,{key:2,value:d.conversation,clickable:"",onClick:s[2]||(s[2]=(0,o.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,n.kq)("",!0),d.conversation?.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("p",l,[d.counterparty!==i.app.myPubkey?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,a.zw)(e.$t("This is the beginning of your message history with"))+" ",1),(0,n.Wm)(k,{pubkey:d.counterparty,clickable:""},null,8,["pubkey"]),(0,n.Uk)(". ")],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)(" Keep private notes by sending messages to yourself. ")],64))]))],512),(0,n._)("div",u,[(0,n.Wm)(v,{recipient:d.counterparty,placeholder:e.$t(d.placeholder),onPublish:d.onPublish,autofocus:""},null,8,["recipient","placeholder","onPublish"])])],64)}var d=t(8803),h=t.n(d),m=t(9010),g=t(5198);const b={class:"message-editor"},y={class:"inline-controls"},k={class:"inline-controls-item"},v={class:"controls"},w={class:"controls-submit"};function f(e,s,t,o,a,i){const r=(0,n.up)("AutoSizeTextarea"),c=(0,n.up)("BaseIcon"),l=(0,n.up)("EmojiPicker"),u=(0,n.up)("q-menu"),p=(0,n.up)("q-btn");return(0,n.wg)(),(0,n.iD)("div",b,[(0,n._)("div",{class:"input-section",onClick:s[1]||(s[1]=s=>e.$refs.textarea.focus())},[(0,n.Wm)(r,{modelValue:a.content,"onUpdate:modelValue":s[0]||(s[0]=e=>a.content=e),ref:"textarea",placeholder:t.placeholder,disabled:a.publishing,rows:1,onSubmit:i.publishMessage,"submit-on-enter":""},null,8,["modelValue","placeholder","disabled","onSubmit"]),(0,n._)("div",y,[(0,n._)("div",k,[(0,n.Wm)(c,{icon:"emoji"}),(0,n.Wm)(u,{ref:"menuEmojiPicker"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{onSelect:i.onEmojiSelected},null,8,["onSelect"])])),_:1},512)])])]),(0,n._)("div",v,[(0,n._)("div",w,[(0,n.Wm)(p,{icon:"send",loading:a.publishing,disable:!i.hasContent(),color:"primary",onClick:i.publishMessage,round:""},null,8,["loading","disable","onClick"])])])])}var _=t(7664),C=t(2056),M=t(3942),Z=t(3099),q=t(6166),P=t(1153),T=t(5155);const j={name:"MessageEditor",components:{AutoSizeTextarea:M.Z,BaseIcon:_.Z,EmojiPicker:C.Z},props:{recipient:{type:String,required:!0},placeholder:{type:String,default:"Message"},autofocus:{type:Boolean,default:!1}},emits:["publish"],data(){return{content:"",publishing:!1}},setup(){return{app:(0,Z.q)(),nostr:(0,q.D)()}},methods:{hasContent(){return this.content.trim().length>0},onEmojiSelected(e){e.native&&(this.$refs.menuEmojiPicker.hide(),this.$refs.textarea.insertText(e.native))},focus(){this.$refs.textarea.focus()},reset(){this.content=""},async publishMessage(){this.publishing=!0;const e=await this.app.encryptMessage(this.recipient,this.content);if(!e)return;const s=P.Z.message(this.app.myPubkey,this.recipient,e).build();await this.app.signEvent(s)&&(await this.nostr.publish(s)?(this.reset(),this.$nextTick(this.focus.bind(this)),this.$emit("publish",s)):this.$q.notify({message:(0,T.$t)("Failed to send message"),color:"negative"}),this.publishing=!1)}},mounted(){this.autofocus&&this.$nextTick(this.focus.bind(this))}};var $=t(1639),E=t(6362),S=t(8879),W=t(2857),x=t(9984),z=t.n(x);const A=(0,$.Z)(j,[["render",f],["__scopeId","data-v-3fb0f059"]]),B=A;z()(j,"components",{QMenu:E.Z,QBtn:S.Z,QIcon:W.Z});var D=t(9715);function U(e,s,t,o,a,i){const r=(0,n.up)("EncryptedMessage"),c=(0,n.up)("q-chat-message");return(0,n.wg)(),(0,n.j4)(c,{sent:i.sent,"bg-color":i.sent?"grey-2":"pink-2",stamp:i.createdAt,class:"chat-message"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{message:t.message,"click-to-decrypt":""},null,8,["message"])])),_:1},8,["sent","bg-color","stamp"])}var F=t(528),H=t(2296);const I={name:"ChatMessage",components:{EncryptedMessage:F.Z},props:{message:{type:Object,required:!0}},setup(){return{app:(0,Z.q)()}},computed:{sent(){return this.message.author===this.app.myPubkey},createdAt(){return H.Z.formatFromNowLong(this.message.created_at)}}};var O=t(4813);const Q=(0,$.Z)(I,[["render",U]]),R=Q;z()(I,"components",{QChatMessage:O.Z});var V=t(3413),Y=t(4520);const N={name:"Conversation",components:{ChatMessage:R,UserName:D.Z,MessageEditor:B,PageHeader:m.Z,UserCard:g.Z,JsonViewer:h()},data(){return{opendata:!1}},setup(){return{app:(0,Z.q)(),messages:(0,V.G)()}},computed:{counterparty(){return(0,Y.FX)(this.$route.params.pubkey)},conversation(){if(this.app.isSignedIn)return this.messages.getConversation(this.app.myPubkey,this.counterparty)},placeholder(){return this.app.myPubkey===this.counterparty?"Jot something down":"Message"}},methods:{openToggle(){this.opendata=!this.opendata},onPublish(){this.markAsRead(),this.scrollToBottom()},markAsRead(){this.app.isSignedIn&&this.counterparty&&this.messages.markAsRead(this.app.myPubkey,this.counterparty)},scrollToBottom(){this.$nextTick((()=>window.scrollTo(0,document.body.scrollHeight)))}},mounted(){this.markAsRead(),this.resizeObserver=new ResizeObserver(this.scrollToBottom.bind(this)),this.resizeObserver.observe(this.$refs.conversation)},unmounted(){this.resizeObserver.disconnect()}},J=(0,$.Z)(N,[["render",p],["__scopeId","data-v-3db0d1d4"]]),K=J;z()(N,"components",{QBtn:S.Z})}}]);