"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[4577],{2875:(t,e,o)=>{o.r(e),o.d(e,{default:()=>at});var s=o(9835),n=o(1957),r=o(6970);const a=t=>((0,s.dD)("data-v-5f9a4839"),t=t(),(0,s.Cn)(),t),i={class:"kind-checkbox ListRawbox"},c={class:"kind-checkbox-item ListRaw"},l=a((()=>(0,s._)("text",{class:"kind-checkbox-text"}," RAW ",-1))),d={ref:"ancestors"},h={key:1,style:{"padding-left":"1.5rem"}},u={key:0},m=a((()=>(0,s._)("div",{style:{"min-height":"80vh"}},null,-1)));function p(t,e,o,a,p,g){const w=(0,s.up)("PageHeader"),_=(0,s.up)("q-btn"),f=(0,s.up)("Thread",!0),k=(0,s.up)("HeroPost"),v=(0,s.up)("q-spinner"),b=(0,s.up)("q-item"),y=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(y,{ref:"page"},{default:(0,s.w5)((()=>[(0,s.Wm)(w,{title:t.$t("thread"),"back-button":""},null,8,["title"]),(0,s._)("div",i,[(0,s._)("div",c,[t.raw?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(_,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:e[0]||(e[0]=(0,n.iM)((e=>t.ToggleRaw()),["stop"])),class:"kind-checkbox-btn"})),t.raw?((0,s.wg)(),(0,s.j4)(_,{key:1,color:"primary",round:"",size:"xs",onClick:e[1]||(e[1]=(0,n.iM)((e=>t.ToggleRaw()),["stop"])),icon:"done"})):(0,s.kq)("",!0),l])]),(0,s._)("div",d,[t.ancestors?.length?((0,s.wg)(),(0,s.j4)(f,{key:0,thread:t.ancestors,"force-bottom-connector":"",class:"ancestors",raw:t.raw},null,8,["thread","raw"])):(0,s.kq)("",!0)],512),(0,s.Wm)(b,{ref:"main",class:"no-padding column"},{default:(0,s.w5)((()=>[t.note?.id?((0,s.wg)(),(0,s.j4)(k,{key:0,note:t.note,connector:t.ancestors?.length>0,raw:t.raw},null,8,["note","connector","raw"])):((0,s.wg)(),(0,s.iD)("div",h,[(0,s.Wm)(v,{size:"sm",style:{"margin-right":"0.5rem"}}),(0,s.Uk)(" "+(0,r.zw)(t.$t("Loading...")),1)]))])),_:1},512),t.children?.length?((0,s.wg)(),(0,s.iD)("div",u,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.children,(e=>((0,s.wg)(),(0,s.iD)("div",{key:e[0].id},[(0,s.Wm)(f,{thread:e,raw:t.raw},null,8,["thread","raw"])])))),128))])):(0,s.kq)("",!0),m,(0,s.Uk)(" "+(0,r.zw)(t.metaAssets),1)])),_:1},512)}o(9665);var g=o(9684),w=o(1842);const _=t=>((0,s.dD)("data-v-5ad65678"),t=t(),(0,s.Cn)(),t),f={class:"post"},k={class:"post-author"},v={class:"post-author-avatar"},b={class:"connector-top"},y={key:0,class:"connector-line"},T={class:"post-author-name"},A={class:"post-content"},I={class:"post-content-header"},C={key:0,class:"in-reply-to"},q={class:"post-content-body"},R={class:"post-content-footer"},D={class:"created-at"},S=_((()=>(0,s._)("span",null,"Â·",-1))),P={class:"post-content-actions"},N={key:0,class:"post-reply"};function Z(t,e,o,a,i,c){const l=(0,s.up)("UserAvatar"),d=(0,s.up)("UserName"),h=(0,s.up)("PostRenderer"),u=(0,s.up)("PostActions"),m=(0,s.up)("q-btn"),p=(0,s.up)("json-viewer"),g=(0,s.up)("PostEditor");return(0,s.wg)(),(0,s.iD)("div",f,[(0,s._)("div",k,[(0,s._)("div",v,[(0,s._)("div",b,[o.connector?((0,s.wg)(),(0,s.iD)("div",y)):(0,s.kq)("",!0)]),(0,s.Wm)(l,{pubkey:o.note.author,clickable:""},null,8,["pubkey"])]),(0,s._)("div",T,[(0,s.Wm)(d,{pubkey:o.note.author,clickable:"","two-line":"","show-verified":""},null,8,["pubkey"])])]),(0,s._)("div",A,[(0,s._)("div",I,[o.note.hasAncestor()?((0,s.wg)(),(0,s.iD)("p",C,[(0,s.Uk)((0,r.zw)(t.$t("Replying to"))+" ",1),(0,s._)("a",{onClick:e[0]||(e[0]=(0,n.iM)((e=>t.goToProfile(c.ancestor?.author)),["stop"]))},[c.ancestor?.author?((0,s.wg)(),(0,s.j4)(d,{key:0,pubkey:c.ancestor?.author},null,8,["pubkey"])):(0,s.kq)("",!0)])])):(0,s.kq)("",!0)]),(0,s._)("div",q,[(0,s._)("p",null,[(0,s.Wm)(h,{note:o.note},null,8,["note"])])]),(0,s._)("div",R,[(0,s._)("p",D,[(0,s._)("span",null,(0,r.zw)(c.formatTime(o.note.createdAt)),1),S,(0,s._)("span",null,(0,r.zw)(c.formatDate(o.note.createdAt)),1)]),(0,s._)("div",P,[(0,s.Wm)(u,{note:o.note,flavor:"hero",onComment:e[1]||(e[1]=e=>t.$refs.editor.focus())},null,8,["note"])])]),a.formState.opendata?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(m,{key:0,color:"primary",size:"sm",onClick:e[2]||(e[2]=(0,n.iM)((t=>c.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_down"})),a.formState.opendata?((0,s.wg)(),(0,s.j4)(m,{key:1,color:"primary",size:"sm",onClick:e[3]||(e[3]=(0,n.iM)((t=>c.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_up"})):(0,s.kq)("",!0),a.formState.opendata?((0,s.wg)(),(0,s.j4)(p,{key:2,value:o.note,clickable:"",onClick:e[4]||(e[4]=(0,n.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,s.kq)("",!0)]),a.app.isSignedIn?((0,s.wg)(),(0,s.iD)("div",N,[(0,s.Wm)(g,{ancestor:o.note,ref:"editor",compact:"",placeholder:t.$t("Post your reply")},null,8,["ancestor","placeholder"])])):(0,s.kq)("",!0)])}var j=o(499),E=o(8803),z=o.n(E),x=o(8354),L=o(8120),F=o(9049),O=o(885),W=o(8039),$=o(3099),M=o(2929),U=o(2296),H=o(1744);const Q={name:"HeroPost",mixins:[M.Z],components:{PostActions:H.Z,UserName:x.Z,UserAvatar:L.Z,PostEditor:O.Z,PostRenderer:F.Z,JsonViewer:z()},props:{note:{type:Object,required:!0},connector:{type:Boolean,default:!1},raw:Boolean},setup(t){const e=(0,j.qj)({opendata:!1});return(0,s.YP)((()=>t.raw),(t=>{e.opendata=t})),{app:(0,$.q)(),nostr:(0,W.D)(),formState:e}},computed:{ancestor(){return this.note.hasAncestor()?this.nostr.getNote(this.note.ancestor()):null}},data(){return{}},methods:{formatDate:U.Z.formatDate,formatTime:U.Z.formatTime,openToggle(){this.formState.opendata=!this.formState.opendata}}};var B=o(1639),Y=o(8879),J=o(9984),K=o.n(J);const V=(0,B.Z)(Q,[["render",Z],["__scopeId","data-v-5ad65678"]]),X=V;K()(Q,"components",{QBtn:Y.Z});var G=o(5547),tt=o(4520);const et=(0,s.aZ)({name:"ThreadPage",components:{HeroPost:X,Thread:w.Z,PageHeader:g.Z},setup(){return{nostr:(0,W.D)()}},data(){return{subId:null,resizeObserver:null,raw:!1}},computed:{noteId(){const t=this.$route.params.id;return t&&t.startsWith("note")?(0,tt.FX)(t):t},note(){if(this.noteId)return this.nostr.getNote(this.noteId)},noteLoaded(){return this.noteId&&this.note?.id===this.noteId},rootId(){if(this.noteLoaded)return this.note.hasAncestor()?this.note.root():this.note.id},root(){if(this.rootId)return this.nostr.getNote(this.rootId)},rootLoaded(){if(this.noteLoaded)return this.root?.id===this.rootId},ancestors(){if(!this.noteLoaded)return;const t=this.allAncestors(this.note);return t.length>0&&t[0].id!==this.rootId&&console.error(`Invalid thread structure: expected root ${this.rootId} but found ${t[0].id}`),this.collectPredecessors(t,this.note)},children(){if(!this.noteLoaded)return;const t=this.note.hasAncestor()?this.nostr.getNote(this.note.ancestor()):null;return this.collectChildren(this.note,t)},metaAssets(){if(this.note){if(!this.noteId)return{};const t=this.nostr.getNote(this.noteId),e={};if(t.content){const o=/(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|gif|png|jpeg|bmp|mp4|mkv|flv|avi)/g,s=t.content.match(o);s&&s.length?e.img=s[0]:e.img="/logo.jpeg",e.desc=t.content.slice(0,130)}else e.img="/logo.jpeg",e.desc="Rewire the social Network.";document&&this.note&&this.removeMeta(),[{class:"share_custom_00001",name:"twitter:card",content:"summary_large_image"},{class:"share_custom_00001",name:"twitter:site",content:"@FreeFrom_Nostr"},{class:"share_custom_00001",name:"twitter:creator",content:"@FreeFrom_Nostr"},{class:"share_custom_00001",name:"twitter:title",content:"FreeFrom-the nostr client"},{class:"share_custom_00001",name:"twitter:description",content:e.desc},{class:"share_custom_00001",name:"twitter:image",content:e.img},{class:"share_custom_00001",name:"og:title",content:"FreeFrom-the nostr client"},{class:"share_custom_00001",name:"og:description",content:e.desc},{class:"share_custom_00001",name:"og:type",content:"website"},{class:"share_custom_00001",name:"og:url",content:"https://freefrom.space"},{class:"share_custom_00001",name:"og:image",content:e.img}].map((t=>{const e=document.createElement("meta");return e.name=t.name,e.content=t.content,e.className=t.class,document.head.appendChild(e),e}))}return""}},methods:{ToggleRaw(){this.raw=!this.raw},startStream(){this.rootId&&(this.stream=this.nostr.streamThread(this.rootId))},closeStream(){this.stream&&(this.stream.close(),this.stream=null)},collectPredecessors(t,e){if(!t||!t.length)return[];const o=t.pop(),s=this.nostr.getRepliesTo(o.id,G.i.CREATION_DATE_ASC),n=s.findIndex((t=>t.id===e.id)),r=[o].concat(s.slice(0,n));return this.collectPredecessors(t,o).concat(r)},collectChildren(t,e){const o=[];if(e){const s=this.nostr.getRepliesTo(e.id,G.i.CREATION_DATE_ASC),n=s.findIndex((e=>e.id===t.id)),r=s.slice(n+1);r.length&&o.push(r)}const s=this.nostr.getRepliesTo(t.id,G.i.CREATION_DATE_DESC);for(const n of s)o.push(this.unrollLongest(n));return o},unrollLinear(t){const e=[t];let o=this.nostr.getRepliesTo(t.id,G.i.CREATION_DATE_ASC);while(1===o.length)e.push(o[0]),t=o[0],o=this.nostr.getRepliesTo(t.id,G.i.CREATION_DATE_ASC);return e},unrollLongest(t){let e=[],o=this.nostr.getRepliesTo(t.id,G.i.CREATION_DATE_ASC);for(const n of o)e.push(this.unrollLongest(n));let s=[];for(const n of e)n.length>=s.length&&(s=n);return[t].concat(s)},allAncestors(t){if(!t.hasAncestor())return[];const e=this.nostr.getNote(t.ancestor());return e?this.allAncestors(e).concat([e]):(console.error(`Couldn't fetch ancestor ${t.ancestor()}`),[])},scrollToMain(){const t=this.$refs.main?.$el;if(!t)return;const e=this.$q.screen.xs?61:78,o=Math.max(t.offsetTop-e,0);window.scrollTo(0,o)},removeMeta(){const t=document.querySelectorAll(".share_custom_00001");t&&t.forEach((t=>{t.remove()}))}},watch:{root(){this.rootLoaded&&this.startStream()}},mounted(){this.startStream(),this.resizeObserver=new ResizeObserver(this.scrollToMain.bind(this)),this.resizeObserver.observe(this.$refs.ancestors),setTimeout((()=>this.resizeObserver.disconnect()),2e3)},unmounted(){this.closeStream(),this.resizeObserver.disconnect(),this.removeMeta()}});var ot=o(9885),st=o(490),nt=o(3940);const rt=(0,B.Z)(et,[["render",p],["__scopeId","data-v-5f9a4839"]]),at=rt;K()(et,"components",{QPage:ot.Z,QBtn:Y.Z,QItem:st.Z,QSpinner:nt.Z})}}]);