"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[57],{396:(e,t,o)=>{o.d(t,{Z:()=>i});var s=o(4520);const n=new Set,i=n;n.isBot=n.has.bind(n),n.add=e=>Set.prototype.add.call(n,(0,s.FX)(e)),n.add("npub1tsgw6pncspg4d5u778hk63s3pls70evs4czfsmx0fzap9xwt203qtkhtk4"),n.add("npub17stpezz4suqdywh33k9x8pht04l76a5sfrsjj7q3mnp5ap5937eqdt58d7"),n.add("npub1xe59lfgsdvduqwh8h65zahkc2hv02mzpmdxghhhcpx0puret9taqheapxc")},9010:(e,t,o)=>{o.d(t,{Z:()=>p});var s=o(9835),n=o(6970);const i={key:0},a={class:"addon"};function r(e,t,o,r,l,c){const u=(0,s.up)("base-icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,s.Wm)(u,{icon:"back"})])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,n.C_)({"profile-info":!!e.subline})},[(0,s.WI)(e.$slots,"default",{},(()=>[(0,s._)("h2",null,(0,n.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,s.wg)(),(0,s.iD)("span",i,(0,n.zw)(e.subline),1)):(0,s.kq)("",!0)]))],2),(0,s._)("div",a,[(0,s.WI)(e.$slots,"addon")])],2)}var l=o(7664);const c=(0,s.aZ)({name:"PageHeader",components:{BaseIcon:l.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var u=o(1639);const d=(0,u.Z)(c,[["render",r]]),p=d},5057:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Ue});var s=o(9835),n=o(1957);const i=e=>((0,s.dD)("data-v-25f3cc8e"),e=e(),(0,s.Cn)(),e),a={class:"Traffic-page"},r={key:0,class:"following"},l={class:"following-wrapper"},c=i((()=>(0,s._)("div",{class:"following-header"},[(0,s._)("h3",null,"Profile List")],-1))),u={class:"following-body"},d=i((()=>(0,s._)("div",{class:"following-gradient"},null,-1)));function p(e,t,o,i,p,h){const b=(0,s.up)("PageHeader"),g=(0,s.up)("SearchBox"),y=(0,s.up)("UserCard"),k=(0,s.up)("q-btn"),m=(0,s.up)("Thread");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(b,{"back-button":""}),(0,s._)("div",a,[(0,s.Wm)(g),i.app.isSignedIn&&h.contacts?.length?((0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",l,[c,(0,s._)("div",u,[((0,s.wg)(),(0,s.j4)(y,{key:i.app.myPubkey,pubkey:i.app.myPubkey,class:"following-body-item",clickable:""},null,8,["pubkey"])),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.contacts,(e=>((0,s.wg)(),(0,s.j4)(y,{key:e.pubkey,pubkey:e.pubkey,class:"following-body-item",clickable:""},null,8,["pubkey"])))),128))]),d])])):(0,s.kq)("",!0),(0,s.Wm)(k,{color:"primary",size:"md",onClick:t[0]||(t[0]=(0,n.iM)((e=>h.getProfile()),["stop"])),label:"Select Pull Back",disabled:p.pubkeyList.length<1||p.loading,class:"qbtn-style"},null,8,["disabled"]),(0,s.Wm)(k,{color:"primary",size:"md",onClick:t[1]||(t[1]=(0,n.iM)((e=>h.empty()),["stop"])),label:"EMPTY",class:"qbtn-style"}),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(p.visible,(e=>((0,s.wg)(),(0,s.j4)(m,{key:e[0].id,thread:e,class:"full-width"},null,8,["thread"])))),128))])],64)}o(9665);const h={class:"user-card"};function b(e,t,o,i,a,r){const l=(0,s.up)("q-btn"),c=(0,s.up)("UserAvatar"),u=(0,s.up)("UserName");return(0,s.wg)(),(0,s.iD)("div",h,[a.check?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(l,{key:0,color:"primary",round:"",outline:"",size:"xs",onClick:t[0]||(t[0]=(0,n.iM)((e=>r.getpubkeyToggle(o.pubkey)),["stop"]))})),a.check?((0,s.wg)(),(0,s.j4)(l,{key:1,color:"primary",round:"",size:"xs",onClick:t[1]||(t[1]=(0,n.iM)((e=>r.Toggle(o.pubkey)),["stop"])),icon:"done"})):(0,s.kq)("",!0),(0,s.Wm)(c,{pubkey:o.pubkey,clickable:o.clickable},null,8,["pubkey","clickable"]),(0,s.Wm)(u,{pubkey:o.pubkey,clickable:o.clickable,class:"username","two-line":"","show-verified":""},null,8,["pubkey","clickable"])])}var g=o(5501),y=o(9715),k=o(7328);const m={name:"UserCard",components:{FollowButton:k.Z,UserName:y.Z,UserAvatar:g.Z},props:{pubkey:{type:String,required:!0},clickable:{type:Boolean,default:!1},followButton:{type:Boolean,default:!1}},data(){return{check:!1}},methods:{getpubkeyToggle(e){console.log("pubkey----",e),this.check=!0,this.$parent.getchildpub(e)},Toggle(e){this.check=!1,this.$parent.delchildpub(e)}}};var f=o(1639),w=o(8879),v=o(9984),_=o.n(v);const q=(0,f.Z)(m,[["render",b],["__scopeId","data-v-3b74a8bc"]]),C=q;_()(m,"components",{QBtn:w.Z});var T=o(6166),B=o(3099),Z=o(2187),D=o(2929),x=o(6970);const P={class:"relative-position"},S={class:"searchbox-wrapper"},A={class:"searchbox-icon"},U={class:"searchbox-input"},j=["placeholder"],F={key:0,class:"searchbox-results"},W={key:0,class:"query-example"},z=(0,s._)("b",null,"npub…",-1),I=(0,s._)("b",null,"[user]@domain",-1),$=(0,s._)("b",null,"name",-1);function L(e,t,o,i,a,r){const l=(0,s.up)("BaseIcon"),c=(0,s.up)("q-form"),u=(0,s.up)("UserCard");return(0,s.wg)(),(0,s.iD)("div",P,[(0,s._)("div",{class:(0,x.C_)(["searchbox",{focused:a.focused}])},[(0,s._)("div",S,[(0,s._)("div",A,[(0,s.Wm)(l,{icon:"search"})]),(0,s._)("div",U,[(0,s.Wm)(c,{onSubmit:(0,n.iM)(r.search,["stop"])},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.query=e),ref:"input",type:"text",placeholder:e.$t("Search profiles"),onFocus:t[1]||(t[1]=(...e)=>r.toggleFocus&&r.toggleFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>r.toggleFocus&&r.toggleFocus(...e)),onKeyup:[t[3]||(t[3]=(...e)=>r.search&&r.search(...e)),t[4]||(t[4]=(0,n.D2)((t=>e.$refs.input.blur()),["esc"]))]},null,40,j),[[n.nr,a.query]])])),_:1},8,["onSubmit"])])])],2),(0,s.Wm)(n.uT,{name:"fade"},{default:(0,s.w5)((()=>[a.focused?((0,s.wg)(),(0,s.iD)("div",F,[a.results.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",W,[z,(0,s.Uk)(" or "),I,(0,s.Uk)(" or "),$])),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.results,(t=>((0,s.wg)(),(0,s.j4)(u,{key:t,pubkey:t,class:"searchbox-results-item",clickable:"",onMousedown:o=>e.goToProfile(t)},null,8,["pubkey","onMousedown"])))),128))])):(0,s.kq)("",!0)])),_:1})])}var M=o(7664),N=o(7175),R=o(5198);const H={name:"SearchBox",mixins:[D.Z],components:{UserCard:R.Z,BaseIcon:M.Z},setup(){return{provider:new N.Z}},data(){return{focused:!1,query:"",results:[]}},methods:{toggleFocus(){this.focused=!this.focused},async search(){this.query?this.results=(await this.provider.queryProfiles(this.query)).slice(0,200):this.results=[]}}};var E=o(8326);const Y=(0,f.Z)(H,[["render",L]]),K=Y;_()(H,"components",{QForm:E.Z});var O=o(9010),Q=o(4520),J=o(7498),V=o(2296),X=o(396);const G={class:"thread"};function ee(e,t,o,n,i,a){const r=(0,s.up)("ListPost");return(0,s.wg)(),(0,s.iD)("div",G,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.filteredThread,((e,t)=>((0,s.wg)(),(0,s.j4)(r,{key:e.id,note:e,"connector-top":a.filteredThread.length>1&&t>0,"connector-bottom":a.filteredThread.length>1&&t<a.filteredThread.length-1||o.forceBottomConnector,actions:"",clickable:""},null,8,["note","connector-top","connector-bottom"])))),128))])}const te=e=>((0,s.dD)("data-v-5e89e630"),e=e(),(0,s.Cn)(),e),oe={class:"post-author"},se={class:"connector-top"},ne={key:0,class:"connector-line"},ie={class:"connector-bottom"},ae={key:0,class:"connector-line"},re={class:"post-content"},le={class:"post-content-header"},ce={class:"author-line"},ue=te((()=>(0,s._)("span",null,"·",-1))),de={class:"created-at"},pe={key:0,class:"in-reply-to"},he={class:"post-content-body"};function be(e,t,o,i,a,r){const l=(0,s.up)("UserAvatar"),c=(0,s.up)("UserName"),u=(0,s.up)("PostRenderer"),d=(0,s.up)("q-btn"),p=(0,s.up)("json-viewer");return(0,s.wg)(),(0,s.iD)("div",{class:(0,x.C_)(["post",{clickable:o.clickable}]),onClick:t[6]||(t[6]=(0,n.iM)((t=>o.clickable&&e.goToThread(o.note.id)),["stop"]))},[(0,s._)("div",oe,[(0,s._)("div",se,[o.connectorTop?((0,s.wg)(),(0,s.iD)("div",ne)):(0,s.kq)("",!0)]),(0,s.Wm)(l,{pubkey:o.note.author,clickable:"",onClick:t[0]||(t[0]=(0,n.iM)((()=>{}),["stop"]))},null,8,["pubkey"]),(0,s._)("div",ie,[o.connectorBottom?((0,s.wg)(),(0,s.iD)("div",ae)):(0,s.kq)("",!0)])]),(0,s._)("div",re,[(0,s._)("div",le,[(0,s._)("p",ce,[(0,s.Wm)(c,{pubkey:o.note.author,clickable:"","show-verified":"",onClick:t[1]||(t[1]=(0,n.iM)((()=>{}),["stop"]))},null,8,["pubkey"]),ue,(0,s._)("span",de,(0,x.zw)(r.createdAt),1)]),o.note.hasAncestor()?((0,s.wg)(),(0,s.iD)("p",pe,[(0,s.Uk)((0,x.zw)(e.$t("Replying to"))+" ",1),(0,s._)("a",{onClick:t[2]||(t[2]=(0,n.iM)((t=>e.goToProfile(r.ancestor?.author)),["stop"]))},[r.ancestor?.author?((0,s.wg)(),(0,s.j4)(c,{key:0,pubkey:r.ancestor?.author},null,8,["pubkey"])):(0,s.kq)("",!0)])])):(0,s.kq)("",!0)]),(0,s._)("div",he,[(0,s.Wm)(u,{note:o.note},null,8,["note"])]),a.opendata?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(d,{key:0,color:"primary",size:"sm",onClick:t[3]||(t[3]=(0,n.iM)((e=>r.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_down"})),a.opendata?((0,s.wg)(),(0,s.j4)(d,{key:1,color:"primary",size:"sm",onClick:t[4]||(t[4]=(0,n.iM)((e=>r.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_up"})):(0,s.kq)("",!0),a.opendata?((0,s.wg)(),(0,s.j4)(p,{key:2,value:o.note,clickable:"",onClick:t[5]||(t[5]=(0,n.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,s.kq)("",!0)])],2)}var ge=o(8803),ye=o.n(ge),ke=o(8500),me=o(8993),fe=o(1153);const we={name:"ListPost",mixins:[D.Z],components:{PostActions:me.Z,UserAvatar:g.Z,UserName:y.Z,PostRenderer:ke.Z,JsonViewer:ye()},props:{note:{type:Object,required:!0},connectorTop:{type:Boolean,default:!1},connectorBottom:{type:Boolean,default:!1},clickable:{type:Boolean,default:!1},actions:{type:Boolean,default:!1}},setup(){return{app:(0,B.q)(),nostr:(0,T.D)()}},data(){return{refreshCounter:0,refreshTimer:null,metadataDialog:!1,noteStr:"",CopyStr:"",opendata:!1}},computed:{ancestor(){return this.note.hasAncestor()?this.nostr.getNote(this.note.ancestor()):null},showActions(){return this.actions&&this.note.canReply()},createdAt(){return this.refreshCounter,this.formatPostDate(this.note.createdAt)}},methods:{openToggle(){this.opendata=!this.opendata},formatPostDate(e){const t=this.$q.screen.lt.md?"short":"long";return V.Z.formatFromNow(e,t)},info(){this.metadataDialog=!0,console.log("str----",this.note.id);let e=(0,Q.Sk)(this.nostr.getNote(this.note.id)),t=JSON.stringify(this.nostr.getNote(this.note.id));console.log("str----",this.nostr.getNote(this.note.id)),this.noteStr=e,this.CopyStr=t},async copystr(e){e&&(console.log("str----",e),await navigator.clipboard.writeText(e).then((()=>{this.$q.notify({message:"Replication Success",color:"positive",timeout:1e3,position:"top"})})))},async del(){const e=fe.Z["delete"](this.note,this.app.myPubkey).build();e.id=this.note.id,console.log("event--------------------",e),await this.app.signEvent(e)&&(await this.nostr.publish(e)||this.$q.notify({message:$t("Failed to publish reaction"),color:"negative"}))},async copyNoteId(){const e=(0,Q.jm)(this.note.id,"note");await navigator.clipboard.writeText(e).then((()=>{this.$q.notify({message:"Replication Success",color:"positive",timeout:1e3,position:"top"})}))},async copyUserId(){const e=(0,Q.jm)(this.note.author,"npub");await navigator.clipboard.writeText(e).then((()=>{this.$q.notify({message:"Replication Success",color:"positive",timeout:1e3,position:"top"})}))}},mounted(){const e=V.Z.now()-this.note.createdAt>=3600?3600:60;this.refreshTimer=setInterval((()=>this.refreshCounter++),1e3*e)},unmounted(){clearInterval(this.refreshTimer)}},ve=(0,f.Z)(we,[["render",be],["__scopeId","data-v-5e89e630"]]),_e=ve;_()(we,"components",{QBtn:w.Z});const qe={name:"Thread",components:{ListPost:_e},props:{thread:{type:Array,required:!0},forceBottomConnector:{type:Boolean,default:!1}},computed:{filteredThread(){return this.thread.filter((e=>!!e))}}},Ce=(0,f.Z)(qe,[["render",ee],["__scopeId","data-v-0969c0bc"]]),Te=Ce,Be="0000000000000000000000000000000000000000000000000000000000000000",Ze=(e,t)=>t[0].createdAt-e[0].createdAt,De=e=>t=>(t.createdAt>e&&(t.createdAt=e),t),xe=()=>(new Date).getTime()/1e3,Pe=25,Se={name:"FollowingBox",components:{UserCard:C,SearchBox:K,PageHeader:O.Z,Thread:Te},mixins:[D.Z],data(){return{visible:[],hideBots:!1,pubkeyList:[],recentlyLoaded:!0,newer:[],older:[],loading:!1}},setup(){return{app:(0,B.q)(),nostr:(0,T.D)()}},computed:{numUnreads(){return this.recentlyLoaded?0:this.newer.length},pubkey(){return this.app.myPubkey},contacts(){return this.nostr.getContacts(this.pubkey)?.slice(0,20)}},methods:{getchildpub(e){this.pubkeyList.push(e),console.log("新pub数组：",this.pubkeyList)},delchildpub(e){const t=this.pubkeyList;t.forEach(((o,s)=>{o==e&&(t.splice(s,1),this.pubkeyList=t)}))},filterNote(e,t){return!e.isReaction()&&(!e.isRepostOrTag()&&(!t||!e.relatedPubkeys().some(X.Z.isBot)))},ensureBech32(e,t){return(0,Q.iY)(e)?e:(0,Q.jm)(e,t)},filters(){let e=this.pubkeyList;return e&&e.length||(e=[Be]),{kinds:[J.nS.NOTE],authors:e,limit:50}},followingdata(){let e=this.pubkeyList;if(!e||!e.length)return[];let t=[];const o=(0,Z.d)();for(const s of e)t=t.concat(o.postsByAuthor(s,Z.i.CREATION_DATE_DESC));return t},empty(){this.visible=""},getProfile(){this.loading=!0;const e=this.filters();this.stream=this.nostr.stream(e,{subId:"",timeout:3e3}),this.stream.on("init",(e=>{const t=this.followingdata()||[],o=e.concat(t).filter((e=>this.filterNote(e,this.hideBots))).map(De(xe())).map((e=>[e])).sort(Ze).filter(((e,t,o)=>!t||e[0].id!==o[t-1][0].id));this.visible=o.slice(0,Pe),console.log("this.this.this.this.this.+++++++++++",this.visible),this.loading=!1}))}}},Ae=(0,f.Z)(Se,[["render",p],["__scopeId","data-v-25f3cc8e"]]),Ue=Ae;_()(Se,"components",{QBtn:w.Z})}}]);