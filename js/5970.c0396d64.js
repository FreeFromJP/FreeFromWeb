"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[5970],{9010:(t,e,o)=>{o.d(e,{Z:()=>u});var s=o(9835),n=o(6970);const r={key:0},i={class:"addon"};function a(t,e,o,a,c,l){const d=(0,s.up)("base-icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["page-header",{dense:t.dense}])},[t.backButton?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-button",onClick:e[0]||(e[0]=e=>t.$router.go(-1))},[(0,s.Wm)(d,{icon:"back"})])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,n.C_)({"profile-info":!!t.subline})},[(0,s.WI)(t.$slots,"default",{},(()=>[(0,s._)("h2",null,(0,n.zw)(t.$t(t.title||t.titleFromRoute()||"Home")),1),t.subline?((0,s.wg)(),(0,s.iD)("span",r,(0,n.zw)(t.subline),1)):(0,s.kq)("",!0)]))],2),(0,s._)("div",i,[(0,s.WI)(t.$slots,"addon")])],2)}var c=o(7664);const l=(0,s.aZ)({name:"PageHeader",components:{BaseIcon:c.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const t=this.$route.name?.toLowerCase();return t?.charAt(0).toUpperCase()+t?.substring(1)}}});var d=o(1639);const h=(0,d.Z)(l,[["render",a]]),u=h},2051:(t,e,o)=>{o.d(e,{Z:()=>d});var s=o(9835);const n={class:"thread"};function r(t,e,o,r,i,a){const c=(0,s.up)("ListPost");return(0,s.wg)(),(0,s.iD)("div",n,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(a.filteredThread,((t,e)=>((0,s.wg)(),(0,s.j4)(c,{key:t.id,note:t,"connector-top":a.filteredThread.length>1&&e>0,"connector-bottom":a.filteredThread.length>1&&e<a.filteredThread.length-1||o.forceBottomConnector,actions:"",clickable:""},null,8,["note","connector-top","connector-bottom"])))),128))])}var i=o(2017);const a={name:"Thread",components:{ListPost:i.Z},props:{thread:{type:Array,required:!0},forceBottomConnector:{type:Boolean,default:!1}},computed:{filteredThread(){return this.thread.filter((t=>!!t))}}};var c=o(1639);const l=(0,c.Z)(a,[["render",r],["__scopeId","data-v-70ea85be"]]),d=l},5970:(t,e,o)=>{o.r(e),o.d(e,{default:()=>V});var s=o(9835),n=o(6970);const r=t=>((0,s.dD)("data-v-c232b40c"),t=t(),(0,s.Cn)(),t),i={ref:"ancestors"},a={key:1,style:{"padding-left":"1.5rem"}},c={key:0},l=r((()=>(0,s._)("div",{style:{"min-height":"80vh"}},null,-1)));function d(t,e,o,r,d,h){const u=(0,s.up)("PageHeader"),p=(0,s.up)("Thread",!0),m=(0,s.up)("HeroPost"),g=(0,s.up)("q-spinner"),f=(0,s.up)("q-item"),v=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(v,{ref:"page"},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{title:t.$t("thread"),"back-button":""},null,8,["title"]),(0,s._)("div",i,[t.ancestors?.length?((0,s.wg)(),(0,s.j4)(p,{key:0,thread:t.ancestors,"force-bottom-connector":"",class:"ancestors"},null,8,["thread"])):(0,s.kq)("",!0)],512),(0,s.Wm)(f,{ref:"main",class:"no-padding column"},{default:(0,s.w5)((()=>[t.note?.id?((0,s.wg)(),(0,s.j4)(m,{key:0,note:t.note,connector:t.ancestors?.length>0},null,8,["note","connector"])):((0,s.wg)(),(0,s.iD)("div",a,[(0,s.Wm)(g,{size:"sm",style:{"margin-right":"0.5rem"}}),(0,s.Uk)(" "+(0,n.zw)(t.$t("Loading...")),1)]))])),_:1},512),t.children?.length?((0,s.wg)(),(0,s.iD)("div",c,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.children,(t=>((0,s.wg)(),(0,s.iD)("div",{key:t[0].id},[(0,s.Wm)(p,{thread:t},null,8,["thread"])])))),128))])):(0,s.kq)("",!0),l])),_:1},512)}o(9665);var h=o(9010),u=o(2051),p=o(1957);const m=t=>((0,s.dD)("data-v-60400dd7"),t=t(),(0,s.Cn)(),t),g={class:"post"},f={class:"post-author"},v={class:"post-author-avatar"},b={class:"connector-top"},k={key:0,class:"connector-line"},_={class:"post-author-name"},T={class:"post-content"},y={class:"post-content-header"},w={key:0,class:"in-reply-to"},A={class:"post-content-body"},I={class:"post-content-footer"},C={class:"created-at"},D=m((()=>(0,s._)("span",null,"Â·",-1))),Z={class:"post-content-actions"},P={key:0,class:"post-reply"};function R(t,e,o,r,i,a){const c=(0,s.up)("UserAvatar"),l=(0,s.up)("UserName"),d=(0,s.up)("PostRenderer"),h=(0,s.up)("PostActions"),u=(0,s.up)("PostEditor");return(0,s.wg)(),(0,s.iD)("div",g,[(0,s._)("div",f,[(0,s._)("div",v,[(0,s._)("div",b,[o.connector?((0,s.wg)(),(0,s.iD)("div",k)):(0,s.kq)("",!0)]),(0,s.Wm)(c,{pubkey:o.note.author,clickable:""},null,8,["pubkey"])]),(0,s._)("div",_,[(0,s.Wm)(l,{pubkey:o.note.author,clickable:"","two-line":"","show-verified":""},null,8,["pubkey"])])]),(0,s._)("div",T,[(0,s._)("div",y,[o.note.hasAncestor()?((0,s.wg)(),(0,s.iD)("p",w,[(0,s.Uk)((0,n.zw)(t.$t("Replying to"))+" ",1),(0,s._)("a",{onClick:e[0]||(e[0]=(0,p.iM)((e=>t.goToProfile(a.ancestor?.author)),["stop"]))},[a.ancestor?.author?((0,s.wg)(),(0,s.j4)(l,{key:0,pubkey:a.ancestor?.author},null,8,["pubkey"])):(0,s.kq)("",!0)])])):(0,s.kq)("",!0)]),(0,s._)("div",A,[(0,s._)("p",null,[(0,s.Wm)(d,{note:o.note},null,8,["note"])])]),(0,s._)("div",I,[(0,s._)("p",C,[(0,s._)("span",null,(0,n.zw)(a.formatTime(o.note.createdAt)),1),D,(0,s._)("span",null,(0,n.zw)(a.formatDate(o.note.createdAt)),1)]),(0,s._)("div",Z,[(0,s.Wm)(h,{note:o.note,flavor:"hero",onComment:e[1]||(e[1]=e=>t.$refs.editor.focus())},null,8,["note"])])])]),r.app.isSignedIn?((0,s.wg)(),(0,s.iD)("div",P,[(0,s.Wm)(u,{ancestor:o.note,ref:"editor",compact:"",placeholder:t.$t("Post your reply")},null,8,["ancestor","placeholder"])])):(0,s.kq)("",!0)])}var $=o(9715),q=o(5501),E=o(8500),L=o(4995),S=o(6166),W=o(3099),z=o(2929),N=o(2296),O=o(8993);const B={name:"HeroPost",mixins:[z.Z],components:{PostActions:O.Z,UserName:$.Z,UserAvatar:q.Z,PostEditor:L.Z,PostRenderer:E.Z},props:{note:{type:Object,required:!0},connector:{type:Boolean,default:!1}},setup(){return{app:(0,W.q)(),nostr:(0,S.D)()}},computed:{ancestor(){return this.note.hasAncestor()?this.nostr.getNote(this.note.ancestor()):null}},methods:{formatDate:N.Z.formatDate,formatTime:N.Z.formatTime}};var H=o(1639);const F=(0,H.Z)(B,[["render",R],["__scopeId","data-v-60400dd7"]]),U=F;var j=o(2187),x=o(4520);const M=(0,s.aZ)({name:"ThreadPage",components:{HeroPost:U,Thread:u.Z,PageHeader:h.Z},setup(){return{nostr:(0,S.D)()}},data(){return{subId:null,resizeObserver:null}},computed:{noteId(){return(0,x.FX)(this.$route.params.id)},note(){if(this.noteId)return this.nostr.getNote(this.noteId)},noteLoaded(){return this.noteId&&this.note?.id===this.noteId},rootId(){if(this.noteLoaded)return this.note.hasAncestor()?this.note.root():this.note.id},root(){if(this.rootId)return this.nostr.getNote(this.rootId)},rootLoaded(){if(this.noteLoaded)return this.root?.id===this.rootId},ancestors(){if(!this.noteLoaded)return;const t=this.allAncestors(this.note);return t.length>0&&t[0].id!==this.rootId&&console.error(`Invalid thread structure: expected root ${this.rootId} but found ${t[0].id}`),this.collectPredecessors(t,this.note)},children(){if(!this.noteLoaded)return;const t=this.note.hasAncestor()?this.nostr.getNote(this.note.ancestor()):null;return this.collectChildren(this.note,t)}},methods:{startStream(){this.rootId&&(this.stream=this.nostr.streamThread(this.rootId))},closeStream(){this.stream&&(this.stream.close(),this.stream=null)},collectPredecessors(t,e){if(!t||!t.length)return[];const o=t.pop(),s=this.nostr.getRepliesTo(o.id,j.i.CREATION_DATE_ASC),n=s.findIndex((t=>t.id===e.id)),r=[o].concat(s.slice(0,n));return this.collectPredecessors(t,o).concat(r)},collectChildren(t,e){const o=[];if(e){const s=this.nostr.getRepliesTo(e.id,j.i.CREATION_DATE_ASC),n=s.findIndex((e=>e.id===t.id)),r=s.slice(n+1);r.length&&o.push(r)}const s=this.nostr.getRepliesTo(t.id,j.i.CREATION_DATE_DESC);for(const n of s)o.push(this.unrollLongest(n));return o},unrollLinear(t){const e=[t];let o=this.nostr.getRepliesTo(t.id,j.i.CREATION_DATE_ASC);while(1===o.length)e.push(o[0]),t=o[0],o=this.nostr.getRepliesTo(t.id,j.i.CREATION_DATE_ASC);return e},unrollLongest(t){let e=[],o=this.nostr.getRepliesTo(t.id,j.i.CREATION_DATE_ASC);for(const n of o)e.push(this.unrollLongest(n));let s=[];for(const n of e)n.length>=s.length&&(s=n);return[t].concat(s)},allAncestors(t){if(!t.hasAncestor())return[];const e=this.nostr.getNote(t.ancestor());return e?this.allAncestors(e).concat([e]):(console.error(`Couldn't fetch ancestor ${t.ancestor()}`),[])},scrollToMain(){const t=this.$refs.main?.$el;if(!t)return;const e=this.$q.screen.xs?61:78,o=Math.max(t.offsetTop-e,0);window.scrollTo(0,o)}},watch:{root(){this.rootLoaded&&this.startStream()}},mounted(){this.startStream(),this.resizeObserver=new ResizeObserver(this.scrollToMain.bind(this)),this.resizeObserver.observe(this.$refs.ancestors),setTimeout((()=>this.resizeObserver.disconnect()),2e3)},unmounted(){this.closeStream(),this.resizeObserver.disconnect()}});var Q=o(9885),K=o(490),Y=o(3940),X=o(9984),G=o.n(X);const J=(0,H.Z)(M,[["render",d],["__scopeId","data-v-c232b40c"]]),V=J;G()(M,"components",{QPage:Q.Z,QItem:K.Z,QSpinner:Y.Z})}}]);