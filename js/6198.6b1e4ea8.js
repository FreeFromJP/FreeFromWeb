"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[6198],{528:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(9835),n=s(6970);function o(e,t,s,o,r,i){const c=(0,a.up)("PostRenderer");return i.note?((0,a.wg)(),(0,a.j4)(c,{key:0,note:i.note},null,8,["note"])):r.decryptFailed?((0,a.wg)(),(0,a.iD)("span",{key:2,class:"decrypt-failed",onClick:t[1]||(t[1]=(...e)=>i.decrypt&&i.decrypt(...e))},(0,n.zw)(e.$t("Decryption failed")),1)):((0,a.wg)(),(0,a.iD)("span",{key:1,class:"click-to-decrypt",onClick:t[0]||(t[0]=e=>s.clickToDecrypt&&i.decrypt())},(0,n.zw)(e.$t("Click to decrypt")),1))}var r=s(3099),i=s(8500),c=s(4264);const p={name:"EncryptedMessage",components:{PostRenderer:i.Z},props:{message:{type:Object,required:!0},clickToDecrypt:{type:Boolean,default:!1}},setup(){return{app:(0,r.q)()}},data(){return{decryptFailed:!1}},computed:{note(){if(!this.message?.plaintext)return;const e=new c.Z(this.message.id,this.message);return e.content=this.message.plaintext,e}},methods:{async decrypt(){if(!this.message.plaintext)try{const e=this.message.id,t=this.message.author===this.app.myPubkey?this.message.recipient:this.message.author,s=await this.app.decryptMessage(t,this.message.content);this.message.id===e&&this.message.cachePlaintext(s)}catch(e){console.error("Failed to decrypt message",e),this.decryptFailed=!0}}},async mounted(){this.app.activeAccount.canDecrypt()&&await this.decrypt()},watch:{async message(){this.app.activeAccount.canDecrypt()&&await this.decrypt()}}};var l=s(1639);const d=(0,l.Z)(p,[["render",o],["__scopeId","data-v-4b8c32d4"]]),u=d},9010:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(9835),n=s(6970);const o={key:0},r={class:"addon"};function i(e,t,s,i,c,p){const l=(0,a.up)("base-icon");return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,a.Wm)(l,{icon:"back"})])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,n.C_)({"profile-info":!!e.subline})},[(0,a.WI)(e.$slots,"default",{},(()=>[(0,a._)("h2",null,(0,n.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,a.wg)(),(0,a.iD)("span",o,(0,n.zw)(e.subline),1)):(0,a.kq)("",!0)]))],2),(0,a._)("div",r,[(0,a.WI)(e.$slots,"addon")])],2)}var c=s(7664);const p=(0,a.aZ)({name:"PageHeader",components:{BaseIcon:c.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var l=s(1639);const d=(0,l.Z)(p,[["render",i]]),u=d},6198:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var a=s(9835),n=s(6970);const o={class:"messages"},r={key:0};function i(e,t,s,i,c,p){const l=(0,a.up)("q-menu"),d=(0,a.up)("q-btn"),u=(0,a.up)("PageHeader"),m=(0,a.up)("ConversationItem"),g=(0,a.up)("BaseIcon"),v=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(u,{"back-button":""},{addon:(0,a.w5)((()=>[(0,a.Wm)(d,{icon:"more_vert",size:"md",round:"",flat:""},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{anchor:"bottom right",self:"top right",offset:[0,6],class:"options-popup"},{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:t[0]||(t[0]=(...e)=>p.markAllAsRead&&p.markAllAsRead(...e))},[(0,a.Uk)((0,n.zw)(e.$t("Mark all as read")),1)])),[[v]])])),_:1})])),_:1})])),_:1}),(0,a._)("div",o,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p.conversations,(e=>((0,a.wg)(),(0,a.j4)(m,{key:e.pubkey,conversation:e},null,8,["conversation"])))),128)),p.conversations?.length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",r,[(0,a.Uk)((0,n.zw)(e.$t("To send a message, click on the"))+" ",1),(0,a.Wm)(g,{icon:"messages"}),(0,a.Uk)(" "+(0,n.zw)(e.$t("icon in the recipient's profile.")),1)]))])],64)}var c=s(9010),p=s(3099),l=s(6166),d=s(3413),u=s(1957);const m={class:"conversation-item-avatar"},g={class:"conversation-item-content"},v={class:"username"},y={key:0,class:"message"},k={class:"conversation-item-info"},h={key:0,class:"created-at"};function w(e,t,s,o,r,i){const c=(0,a.up)("UserAvatar"),p=(0,a.up)("UserName"),l=(0,a.up)("EncryptedMessage"),d=(0,a.up)("q-btn"),w=(0,a.up)("json-viewer"),b=(0,a.up)("q-badge");return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["conversation-item",{"has-unread":s.conversation.numUnread}]),onClick:t[3]||(t[3]=e=>i.goToConversation())},[(0,a._)("div",m,[(0,a.Wm)(c,{pubkey:s.conversation.pubkey},null,8,["pubkey"])]),(0,a._)("div",g,[(0,a._)("div",v,[(0,a.Wm)(p,{pubkey:s.conversation.pubkey,"show-verified":""},null,8,["pubkey"])]),s.conversation.latestMessage?((0,a.wg)(),(0,a.iD)("div",y,[(0,a.Wm)(l,{message:s.conversation.latestMessage},null,8,["message"])])):(0,a.kq)("",!0),r.opendata?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(d,{key:1,color:"primary",size:"sm",onClick:t[0]||(t[0]=(0,u.iM)((e=>i.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_down"})),r.opendata?((0,a.wg)(),(0,a.j4)(d,{key:2,color:"primary",size:"sm",onClick:t[1]||(t[1]=(0,u.iM)((e=>i.openToggle()),["stop"])),label:"raw data",class:"qbtn-style","icon-right":"arrow_drop_up"})):(0,a.kq)("",!0),r.opendata?((0,a.wg)(),(0,a.j4)(w,{key:3,value:s.conversation,clickable:"",onClick:t[2]||(t[2]=(0,u.iM)((()=>{}),["stop"])),theme:"my-awesome-json-theme"},null,8,["value"])):(0,a.kq)("",!0)]),(0,a._)("div",k,[s.conversation.latestMessage?((0,a.wg)(),(0,a.iD)("div",h,(0,n.zw)(i.createdAt),1)):(0,a.kq)("",!0),s.conversation.numUnread?((0,a.wg)(),(0,a.j4)(b,{key:1,label:s.conversation.numUnread,color:"primary",class:"unreads",rounded:""},null,8,["label"])):(0,a.kq)("",!0)])],2)}s(9665);var b=s(8803),f=s.n(b),_=s(5501),C=s(9715),Z=s(528),q=s(2296),D=s(4520);const A={name:"ConversationItem",components:{EncryptedMessage:Z.Z,UserName:C.Z,UserAvatar:_.Z,JsonViewer:f()},props:{conversation:{type:Object,required:!0}},computed:{createdAt(){if(!this.conversation.latestMessage)return;const e=this.$q.screen.lt.md?"short":"long";return q.Z.formatFromNow(this.conversation.latestMessage.created_at,e)}},data(){return{opendata:!1}},methods:{openToggle(){this.opendata=!this.opendata},goToConversation(){this.$router.push({name:"conversation",params:{pubkey:(0,D.jm)(this.conversation.pubkey,"npub")}})}}};var M=s(1639),B=s(8879),I=s(990),W=s(9984),$=s.n(W);const j=(0,M.Z)(A,[["render",w],["__scopeId","data-v-5fd1ccc7"]]),z=j;$()(A,"components",{QBtn:B.Z,QBadge:I.Z});var F=s(7664);const U={name:"Messages",components:{BaseIcon:F.Z,ConversationItem:z,PageHeader:c.Z},setup(){return{app:(0,p.q)(),nostr:(0,l.D)(),messages:(0,d.G)()}},computed:{conversations(){return this.app.isSignedIn?this.messages.getConversations(this.app.myPubkey):[]}},methods:{markAllAsRead(){this.messages.markAllAsRead(this.app.myPubkey)}}};var P=s(6362),T=s(2146);const R=(0,M.Z)(U,[["render",i],["__scopeId","data-v-0112f406"]]),H=R;$()(U,"components",{QBtn:B.Z,QMenu:P.Z}),$()(U,"directives",{ClosePopup:T.Z})}}]);