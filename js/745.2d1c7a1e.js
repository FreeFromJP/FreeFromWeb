"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[745],{528:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(9835),a=s(6970);function i(e,t,s,i,o,r){const c=(0,n.up)("PostRenderer");return r.note?((0,n.wg)(),(0,n.j4)(c,{key:0,note:r.note},null,8,["note"])):o.decryptFailed?((0,n.wg)(),(0,n.iD)("span",{key:2,class:"decrypt-failed",onClick:t[1]||(t[1]=(...e)=>r.decrypt&&r.decrypt(...e))},(0,a.zw)(e.$t("Decryption failed")),1)):((0,n.wg)(),(0,n.iD)("span",{key:1,class:"click-to-decrypt",onClick:t[0]||(t[0]=e=>s.clickToDecrypt&&r.decrypt())},(0,a.zw)(e.$t("Click to decrypt")),1))}var o=s(3099),r=s(8500),c=s(4264);const l={name:"EncryptedMessage",components:{PostRenderer:r.Z},props:{message:{type:Object,required:!0},clickToDecrypt:{type:Boolean,default:!1}},setup(){return{app:(0,o.q)()}},data(){return{decryptFailed:!1}},computed:{note(){if(!this.message?.plaintext)return;const e=new c.Z(this.message.id,this.message);return e.content=this.message.plaintext,e}},methods:{async decrypt(){if(!this.message.plaintext)try{const e=this.message.id,t=this.message.author===this.app.myPubkey?this.message.recipient:this.message.author,s=await this.app.decryptMessage(t,this.message.content);this.message.id===e&&this.message.cachePlaintext(s)}catch(e){console.error("Failed to decrypt message",e),this.decryptFailed=!0}}},async mounted(){this.app.activeAccount.canDecrypt()&&await this.decrypt()},watch:{async message(){this.app.activeAccount.canDecrypt()&&await this.decrypt()}}};var p=s(1639);const u=(0,p.Z)(l,[["render",i],["__scopeId","data-v-4b8c32d4"]]),d=u},9010:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(9835),a=s(6970);const i={key:0},o={class:"addon"};function r(e,t,s,r,c,l){const p=(0,n.up)("base-icon");return(0,n.wg)(),(0,n.iD)("div",{class:(0,a.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,n.wg)(),(0,n.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,n.Wm)(p,{icon:"back"})])):(0,n.kq)("",!0),(0,n._)("div",{class:(0,a.C_)({"profile-info":!!e.subline})},[(0,n.WI)(e.$slots,"default",{},(()=>[(0,n._)("h2",null,(0,a.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,n.wg)(),(0,n.iD)("span",i,(0,a.zw)(e.subline),1)):(0,n.kq)("",!0)]))],2),(0,n._)("div",o,[(0,n.WI)(e.$slots,"addon")])],2)}var c=s(7664);const l=(0,n.aZ)({name:"PageHeader",components:{BaseIcon:c.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var p=s(1639);const u=(0,p.Z)(l,[["render",r]]),d=u},6745:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var n=s(9835),a=s(6970);const i=e=>((0,n.dD)("data-v-5d216dcb"),e=e(),(0,n.Cn)(),e),o={ref:"conversation",class:"conversation"},r=i((()=>(0,n._)("div",{class:"pusher"},null,-1))),c={key:0,class:"placeholder"},l={class:"conversation-reply"};function p(e,t,s,i,p,u){const d=(0,n.up)("UserCard"),h=(0,n.up)("PageHeader"),m=(0,n.up)("ChatMessage"),g=(0,n.up)("UserName"),y=(0,n.up)("MessageEditor");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(h,{"back-button":"",dense:""},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{pubkey:u.counterparty,class:"conversation-header",clickable:""},null,8,["pubkey"])])),_:1}),(0,n._)("div",o,[r,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(u.conversation,(e=>((0,n.wg)(),(0,n.j4)(m,{key:e.id,message:e},null,8,["message"])))),128)),u.conversation?.length?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("p",c,[u.counterparty!==i.app.myPubkey?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n.Uk)((0,a.zw)(e.$t("This is the beginning of your message history with"))+" ",1),(0,n.Wm)(g,{pubkey:u.counterparty,clickable:""},null,8,["pubkey"]),(0,n.Uk)(". ")],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)(" Keep private notes by sending messages to yourself. ")],64))]))],512),(0,n._)("div",l,[(0,n.Wm)(y,{recipient:u.counterparty,placeholder:e.$t(u.placeholder),onPublish:u.onPublish,autofocus:""},null,8,["recipient","placeholder","onPublish"])])],64)}var u=s(9010),d=s(5198);const h={class:"message-editor"},m={class:"inline-controls"},g={class:"inline-controls-item"},y={class:"controls"},b={class:"controls-submit"};function k(e,t,s,a,i,o){const r=(0,n.up)("AutoSizeTextarea"),c=(0,n.up)("BaseIcon"),l=(0,n.up)("EmojiPicker"),p=(0,n.up)("q-menu"),u=(0,n.up)("q-btn");return(0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("div",{class:"input-section",onClick:t[1]||(t[1]=t=>e.$refs.textarea.focus())},[(0,n.Wm)(r,{modelValue:i.content,"onUpdate:modelValue":t[0]||(t[0]=e=>i.content=e),ref:"textarea",placeholder:s.placeholder,disabled:i.publishing,rows:1,onSubmit:o.publishMessage,"submit-on-enter":""},null,8,["modelValue","placeholder","disabled","onSubmit"]),(0,n._)("div",m,[(0,n._)("div",g,[(0,n.Wm)(c,{icon:"emoji"}),(0,n.Wm)(p,{ref:"menuEmojiPicker"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{onSelect:o.onEmojiSelected},null,8,["onSelect"])])),_:1},512)])])]),(0,n._)("div",y,[(0,n._)("div",b,[(0,n.Wm)(u,{icon:"send",loading:i.publishing,disable:!o.hasContent(),color:"primary",onClick:o.publishMessage,round:""},null,8,["loading","disable","onClick"])])])])}var v=s(7664),f=s(2056),w=s(3942),C=s(3099),Z=s(6166),_=s(1153),P=s(5155);const $={name:"MessageEditor",components:{AutoSizeTextarea:w.Z,BaseIcon:v.Z,EmojiPicker:f.Z},props:{recipient:{type:String,required:!0},placeholder:{type:String,default:"Message"},autofocus:{type:Boolean,default:!1}},emits:["publish"],data(){return{content:"",publishing:!1}},setup(){return{app:(0,C.q)(),nostr:(0,Z.D)()}},methods:{hasContent(){return this.content.trim().length>0},onEmojiSelected(e){e.native&&(this.$refs.menuEmojiPicker.hide(),this.$refs.textarea.insertText(e.native))},focus(){this.$refs.textarea.focus()},reset(){this.content=""},async publishMessage(){this.publishing=!0;const e=await this.app.encryptMessage(this.recipient,this.content);if(!e)return;const t=_.Z.message(this.app.myPubkey,this.recipient,e).build();await this.app.signEvent(t)&&(await this.nostr.publish(t)?(this.reset(),this.$nextTick(this.focus.bind(this)),this.$emit("publish",t)):this.$q.notify({message:(0,P.$t)("Failed to send message"),color:"negative"}),this.publishing=!1)}},mounted(){this.autofocus&&this.$nextTick(this.focus.bind(this))}};var D=s(1639),M=s(6362),T=s(8879),W=s(2857),q=s(9984),x=s.n(q);const B=(0,D.Z)($,[["render",k],["__scopeId","data-v-3fb0f059"]]),S=B;x()($,"components",{QMenu:M.Z,QBtn:T.Z,QIcon:W.Z});var E=s(9715);function F(e,t,s,a,i,o){const r=(0,n.up)("EncryptedMessage"),c=(0,n.up)("q-chat-message");return(0,n.wg)(),(0,n.j4)(c,{sent:o.sent,"bg-color":o.sent?"grey-2":"pink-2",stamp:o.createdAt,class:"chat-message"},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{message:s.message,"click-to-decrypt":""},null,8,["message"])])),_:1},8,["sent","bg-color","stamp"])}var j=s(528),A=s(2296);const z={name:"ChatMessage",components:{EncryptedMessage:j.Z},props:{message:{type:Object,required:!0}},setup(){return{app:(0,C.q)()}},computed:{sent(){return this.message.author===this.app.myPubkey},createdAt(){return A.Z.formatFromNowLong(this.message.createdAt)}}};var I=s(396);const H=(0,D.Z)(z,[["render",F]]),R=H;x()(z,"components",{QChatMessage:I.Z});var U=s(3413),O=s(4520);const Q={name:"Conversation",components:{ChatMessage:R,UserName:E.Z,MessageEditor:S,PageHeader:u.Z,UserCard:d.Z},setup(){return{app:(0,C.q)(),messages:(0,U.G)()}},computed:{counterparty(){return(0,O.FX)(this.$route.params.pubkey)},conversation(){if(this.app.isSignedIn)return this.messages.getConversation(this.app.myPubkey,this.counterparty)},placeholder(){return this.app.myPubkey===this.counterparty?"Jot something down":"Message"}},methods:{onPublish(){this.markAsRead(),this.scrollToBottom()},markAsRead(){this.app.isSignedIn&&this.counterparty&&this.messages.markAsRead(this.app.myPubkey,this.counterparty)},scrollToBottom(){this.$nextTick((()=>window.scrollTo(0,document.body.scrollHeight)))}},mounted(){this.markAsRead(),this.resizeObserver=new ResizeObserver(this.scrollToBottom.bind(this)),this.resizeObserver.observe(this.$refs.conversation)},unmounted(){this.resizeObserver.disconnect()}},Y=(0,D.Z)(Q,[["render",p],["__scopeId","data-v-5d216dcb"]]),N=Y}}]);