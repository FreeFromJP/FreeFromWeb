"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[782],{6401:(e,t,o)=>{o.d(t,{Z:()=>f});var s=o(9835),n=o(6970);const i={key:0,class:"list-placeholder"},a={key:1};function l(e,t,o,l,r,d){const c=(0,s.up)("q-spinner");return o.count?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",i,[o.loading?((0,s.wg)(),(0,s.j4)(c,{key:0,size:"sm"})):((0,s.wg)(),(0,s.iD)("p",a,(0,n.zw)(e.$t(o.label)),1))]))}const r={name:"ListPlaceholder",props:{count:{type:Number,default:0},loading:{type:Boolean,default:!1},label:{type:String,default:"Nothing here."}}};var d=o(1639),c=o(3940),u=o(9984),h=o.n(u);const p=(0,d.Z)(r,[["render",l],["__scopeId","data-v-fdc49960"]]),f=p;h()(r,"components",{QSpinner:c.Z})},9010:(e,t,o)=>{o.d(t,{Z:()=>h});var s=o(9835),n=o(6970);const i={key:0},a={class:"addon"};function l(e,t,o,l,r,d){const c=(0,s.up)("base-icon");return(0,s.wg)(),(0,s.iD)("div",{class:(0,n.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,s.Wm)(c,{icon:"back"})])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,n.C_)({"profile-info":!!e.subline})},[(0,s.WI)(e.$slots,"default",{},(()=>[(0,s._)("h2",null,(0,n.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,s.wg)(),(0,s.iD)("span",i,(0,n.zw)(e.subline),1)):(0,s.kq)("",!0)]))],2),(0,s._)("div",a,[(0,s.WI)(e.$slots,"addon")])],2)}var r=o(7664);const d=(0,s.aZ)({name:"PageHeader",components:{BaseIcon:r.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var c=o(1639);const u=(0,c.Z)(d,[["render",l]]),h=u},2051:(e,t,o)=>{o.d(t,{Z:()=>c});var s=o(9835);const n={class:"thread"};function i(e,t,o,i,a,l){const r=(0,s.up)("ListPost");return(0,s.wg)(),(0,s.iD)("div",n,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.filteredThread,((e,t)=>((0,s.wg)(),(0,s.j4)(r,{key:e.id,note:e,"connector-top":l.filteredThread.length>1&&t>0,"connector-bottom":l.filteredThread.length>1&&t<l.filteredThread.length-1||o.forceBottomConnector,actions:"",clickable:""},null,8,["note","connector-top","connector-bottom"])))),128))])}var a=o(9687);const l={name:"Thread",components:{ListPost:a.Z},props:{thread:{type:Array,required:!0},forceBottomConnector:{type:Boolean,default:!1}},computed:{filteredThread(){return this.thread.filter((e=>!!e))}}};var r=o(1639);const d=(0,r.Z)(l,[["render",i],["__scopeId","data-v-70ea85be"]]),c=d},4782:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ue});var s=o(9835);const n={class:"SearchBox-List"};function i(e,t,o,i,a,l){const r=(0,s.up)("q-btn-toggle"),d=(0,s.up)("PageHeader"),c=(0,s.up)("SearchBox"),u=(0,s.up)("Feed",!0),h=(0,s.up)("q-tab-panel"),p=(0,s.up)("q-tab-panels"),f=(0,s.up)("q-page");return(0,s.wg)(),(0,s.j4)(f,null,{default:(0,s.w5)((()=>[(0,s.Wm)(d,{logo:"",class:"page-header"},{addon:(0,s.w5)((()=>[e.availableFeeds.length>1?((0,s.wg)(),(0,s.j4)(r,{key:0,modelValue:e.activeFeed,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeFeed=t),rounded:"","toggle-color":"primary",size:"sm",class:"feed-selector",options:[{value:"following",icon:"group",title:e.$t("Following")},{value:"global",icon:"public",title:e.$t("Global")}]},null,8,["modelValue","options"])):(0,s.kq)("",!0)])),_:1}),(0,s._)("div",n,[(0,s.Wm)(c)]),(0,s.Wm)(p,{modelValue:e.activeFeed,"onUpdate:modelValue":t[1]||(t[1]=t=>e.activeFeed=t),"keep-alive":"",animated:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.availableFeeds,(t=>((0,s.wg)(),(0,s.j4)(h,{key:t,name:t},{default:(0,s.w5)((()=>[(0,s.Wm)(u,{feed:e.feedDef(t),ref_for:!0,ref:t,onLoad:e.onFeedLoaded},null,8,["feed","onLoad"])])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue"])])),_:1})}o(9665);var a=o(9010),l=o(6970);const r={class:"feed"};function d(e,t,o,n,i,a){const d=(0,s.up)("AsyncLoadButton"),c=(0,s.up)("Thread"),u=(0,s.up)("ListPlaceholder");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",{class:(0,l.C_)(["load-more-container",{"more-available":a.numUnreads}])},[a.numUnreads?((0,s.wg)(),(0,s.j4)(d,{key:0,"load-fn":a.loadNewer,label:e.$t("Load {unread} unread",{unread:a.numUnreads})},null,8,["load-fn","label"])):(0,s.kq)("",!0)],2),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.visible,(e=>((0,s.wg)(),(0,s.j4)(c,{key:e[0].id,thread:e,class:"full-width"},null,8,["thread"])))),128)),(0,s.Wm)(u,{count:i.visible.length,loading:i.loading},null,8,["count","loading"]),i.visible.length?((0,s.wg)(),(0,s.j4)(d,{key:0,"load-fn":a.loadOlder,autoload:""},null,8,["load-fn"])):(0,s.kq)("",!0)])}const c={ref:"button",class:"async-load-button"};function u(e,t,o,n,i,a){const l=(0,s.up)("q-btn");return(0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(l,{loading:e.loading,label:e.$t(e.noMore?e.labelNoMore:e.label),onClick:e.load,size:"md",flat:""},null,8,["loading","label","onClick"])],512)}const h=(0,s.aZ)({name:"AsyncLoadButton",emits:["loading","loaded"],props:{loadFn:{type:Function,required:!0},label:{type:String,default:"Load more"},labelNoMore:{type:String,default:"No more items. Try again?"},autoload:{type:Boolean,default:!1}},data(){return{loading:!1,noMore:!1,observer:null}},methods:{async load(){if(this.loading)return;this.loading=!0,this.$emit("loading");const e=await this.loadFn();this.noMore=!e||!e.length,this.loading=!1,this.$emit("loaded",e)}},mounted(){this.autoload&&(this.observer=new IntersectionObserver(this.load.bind(this),{root:null,threshold:.5}),this.observer.observe(this.$refs.button))},unmounted(){this.observer&&this.observer.disconnect()}});var p=o(1639),f=o(8879),m=o(9984),g=o.n(m);const b=(0,p.Z)(h,[["render",u],["__scopeId","data-v-25cf639a"]]),v=b;g()(h,"components",{QBtn:f.Z});var w=o(2051),y=o(6401),k=o(3099),F=o(6166),_=o(2296),q=o(4520);const B=new Set,Z=B;B.isBot=B.has.bind(B),B.add=e=>Set.prototype.add.call(B,(0,q.FX)(e)),B.add("npub1tsgw6pncspg4d5u778hk63s3pls70evs4czfsmx0fzap9xwt203qtkhtk4"),B.add("npub17stpezz4suqdywh33k9x8pht04l76a5sfrsjj7q3mnp5ap5937eqdt58d7"),B.add("npub1xe59lfgsdvduqwh8h65zahkc2hv02mzpmdxghhhcpx0puret9taqheapxc");const D=(e,t)=>t[0].createdAt-e[0].createdAt,T=e=>t=>(t.createdAt>e&&(t.createdAt=e),t),x=()=>(new Date).getTime()/1e3,L=25,S={name:"Feed",emits:["load"],components:{ListPlaceholder:y.Z,Thread:w.Z,AsyncLoadButton:v},props:{feed:{type:Object,required:!0}},setup(){return{app:(0,k.q)(),nostr:(0,F.D)()}},data(){return{visible:[],newer:[],older:[],stream:null,loading:!0,recentlyLoaded:!0}},computed:{numUnreads(){return this.recentlyLoaded?0:this.newer.length},timestampNewest(){return this.visible[0]?.[0]?.createdAt},timestampOldest(){return this.visible[this.visible.length-1]?.[0]?.createdAt}},methods:{init(){const e="function"===typeof this.feed.filters?this.feed.filters():this.feed.filters;this.stream=this.nostr.stream(e,{subId:`feed:${this.feed.name}`,timeout:3e3}),this.stream.on("init",(e=>{const t="function"===typeof this.feed.data?this.feed.data():this.feed.data||[],o=e.concat(t).filter((e=>this.filterNote(e,this.feed.hideBots))).map(T(x())).map((e=>[e])).sort(D).filter(((e,t,o)=>!t||e[0].id!==o[t-1][0].id));this.visible=o.slice(0,L),this.loading=!1,this.$emit("load",this.feed),setTimeout((()=>this.recentlyLoaded=!1),5e3)})),this.stream.on("update",(e=>{if(this.filterNote(e,this.feed.hideBots))if(e=T(x())(e),e.createdAt>=this.timestampNewest)this.newer.push([e]);else if(e.createdAt>=this.timestampOldest){const t=this.visible.findIndex((t=>t[0].createdAt<=e.createdAt));this.visible.splice(t,0,[e])}}))},reload(){this.stream&&(this.loading=!0,this.stream.close(),this.init())},loadNewer(){this.newer.sort(D);const e=this.newer.concat(this.visible);if(e.length>L){const t=e.splice(L);this.older=t.concat(this.older)}return this.visible=e,this.newer=[],this.recentlyLoaded=!0,setTimeout((()=>this.recentlyLoaded=!1),5e3),!0},async loadOlder(){const e="function"===typeof this.feed.filters?this.feed.filters():this.feed.filters,t=this.timestampOldest||_.Z.now(),o=Object.assign({},e,{until:t});if(this.older.length>=o.limit){const e=this.older.splice(0,o.limit);return this.visible=this.visible.concat(e),e}this.older=[];const s=await this.nostr.fetch(o,{subId:`feed:${this.feed.name}-older`}),n=s.filter((e=>e.createdAt<=t)).filter((e=>this.filterNote(e,this.feed.hideBots))).map((e=>[e])).sort(D);return this.visible=this.visible.concat(n),n},filterNote(e,t){return!e.isReaction()&&(!e.isRepostOrTag()&&(!t||!e.relatedPubkeys().some(Z.isBot)))}},mounted(){this.init()},unmounted(){this.stream&&this.stream.close()}},A=(0,p.Z)(S,[["render",d],["__scopeId","data-v-b0dae250"]]),C=A;var $=o(7498),I=o(2187),P=o(1957);const z={class:"relative-position"},N={class:"searchbox-wrapper"},W={class:"searchbox-icon"},j={class:"searchbox-input"},O=["placeholder"],U={key:0,class:"searchbox-results"},H={key:0,class:"query-example"},M=(0,s._)("b",null,"npubâ€¦",-1),Q=(0,s._)("b",null,"[user]@domain",-1),V=(0,s._)("b",null,"name",-1);function E(e,t,o,n,i,a){const r=(0,s.up)("BaseIcon"),d=(0,s.up)("q-form"),c=(0,s.up)("UserCard");return(0,s.wg)(),(0,s.iD)("div",z,[(0,s._)("div",{class:(0,l.C_)(["searchbox",{focused:i.focused}])},[(0,s._)("div",N,[(0,s._)("div",W,[(0,s.Wm)(r,{icon:"search"})]),(0,s._)("div",j,[(0,s.Wm)(d,{onSubmit:(0,P.iM)(a.search,["stop"])},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.query=e),ref:"input",type:"text",placeholder:e.$t("Search ..."),onFocus:t[1]||(t[1]=(...e)=>a.toggleFocus&&a.toggleFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>a.toggleFocus&&a.toggleFocus(...e)),onKeyup:[t[3]||(t[3]=(...e)=>a.search&&a.search(...e)),t[4]||(t[4]=(0,P.D2)((t=>e.$refs.input.blur()),["esc"]))]},null,40,O),[[P.nr,i.query]])])),_:1},8,["onSubmit"])])])],2),(0,s.Wm)(P.uT,{name:"fade"},{default:(0,s.w5)((()=>[i.focused?((0,s.wg)(),(0,s.iD)("div",U,[i.results.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",H,[M,(0,s.Uk)(" or "),Q,(0,s.Uk)(" or "),V])),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.results,(t=>((0,s.wg)(),(0,s.j4)(c,{key:t,pubkey:t,class:"searchbox-results-item",clickable:"",onMousedown:o=>e.goToProfile(t)},null,8,["pubkey","onMousedown"])))),128))])):(0,s.kq)("",!0)])),_:1})])}var K=o(7664),R=o(7175),Y=o(5198),G=o(2929);const X={name:"SearchBox",mixins:[G.Z],components:{UserCard:Y.Z,BaseIcon:K.Z},setup(){return{provider:new R.Z}},data(){return{focused:!1,query:"",results:[]}},methods:{toggleFocus(){this.focused=!this.focused},async search(){this.query?this.results=(await this.provider.queryProfiles(this.query)).slice(0,200):this.results=[]}}};var J=o(8326);const ee=(0,p.Z)(X,[["render",E]]),te=ee;g()(X,"components",{QForm:J.Z});const oe="0000000000000000000000000000000000000000000000000000000000000000",se=()=>{const e=(0,k.q)(),t=(0,F.D)(),o=t.getContacts(e.myPubkey);return o?.map((e=>e.pubkey)).concat(e.myPubkey)},ne={global:{name:"global",filters:{kinds:[$.nS.NOTE],limit:20},hideBots:!0},following:{name:"following",filters:()=>{let e=se();return e&&e.length||(e=[oe]),{kinds:[$.nS.NOTE],authors:e,limit:50}},data:()=>{let e=se();if(!e||!e.length)return[];let t=[];const o=(0,I.d)();for(const s of e)t=t.concat(o.postsByAuthor(s,I.i.CREATION_DATE_DESC));return t},hideBots:!1}},ie=(0,s.aZ)({name:"FeedPage",components:{PageHeader:a.Z,Feed:C,SearchBox:te},setup(){return{app:(0,k.q)(),nostr:(0,F.D)()}},data(){return{feeds:{},activeFeed:this.app.isSignedIn?"following":"global",initialized:!1}},computed:{availableFeeds(){const e=[];return this.app.isSignedIn&&e.push("following"),e.push("global"),e},contacts(){if(this.app.isSignedIn)return this.nostr.getContacts(this.app.myPubkey)}},methods:{feedDef(e){return ne[e]},initFeed(){this.initialized||this.contacts&&(this.initialized=!0,this.activeFeed=this.contacts?.length?"following":"global")},onFeedLoaded(e){"following"!==this.activeFeed||e?.name!==this.activeFeed||this.contacts?.length||this.initialized||(this.initialized=!0)}},watch:{contacts(){this.initFeed(),this.$refs.following?.[0]?.reload()}},mounted(){this.initFeed()}});var ae=o(9885),le=o(8983),re=o(4016),de=o(4106);const ce=(0,p.Z)(ie,[["render",i],["__scopeId","data-v-17511aba"]]),ue=ce;g()(ie,"components",{QPage:ae.Z,QBtnToggle:le.Z,QTabPanels:re.Z,QTabPanel:de.Z})}}]);