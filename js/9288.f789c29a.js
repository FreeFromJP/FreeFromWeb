"use strict";(globalThis["webpackChunkFreeFromWeb"]=globalThis["webpackChunkFreeFromWeb"]||[]).push([[9288],{528:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(9835),n=s(6970);function o(e,t,s,o,r,i){const c=(0,a.up)("PostRenderer");return i.note?((0,a.wg)(),(0,a.j4)(c,{key:0,note:i.note},null,8,["note"])):r.decryptFailed?((0,a.wg)(),(0,a.iD)("span",{key:2,class:"decrypt-failed",onClick:t[1]||(t[1]=(...e)=>i.decrypt&&i.decrypt(...e))},(0,n.zw)(e.$t("Decryption failed")),1)):((0,a.wg)(),(0,a.iD)("span",{key:1,class:"click-to-decrypt",onClick:t[0]||(t[0]=e=>s.clickToDecrypt&&i.decrypt())},(0,n.zw)(e.$t("Click to decrypt")),1))}var r=s(3099),i=s(8500),c=s(4264);const p={name:"EncryptedMessage",components:{PostRenderer:i.Z},props:{message:{type:Object,required:!0},clickToDecrypt:{type:Boolean,default:!1}},setup(){return{app:(0,r.q)()}},data(){return{decryptFailed:!1}},computed:{note(){if(!this.message?.plaintext)return;const e=new c.Z(this.message.id,this.message);return e.content=this.message.plaintext,e}},methods:{async decrypt(){if(!this.message.plaintext)try{const e=this.message.id,t=this.message.author===this.app.myPubkey?this.message.recipient:this.message.author,s=await this.app.decryptMessage(t,this.message.content);this.message.id===e&&this.message.cachePlaintext(s)}catch(e){console.error("Failed to decrypt message",e),this.decryptFailed=!0}}},async mounted(){this.app.activeAccount.canDecrypt()&&await this.decrypt()},watch:{async message(){this.app.activeAccount.canDecrypt()&&await this.decrypt()}}};var d=s(1639);const l=(0,d.Z)(p,[["render",o],["__scopeId","data-v-4b8c32d4"]]),u=l},9010:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(9835),n=s(6970);const o={key:0},r={class:"addon"};function i(e,t,s,i,c,p){const d=(0,a.up)("base-icon");return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["page-header",{dense:e.dense}])},[e.backButton?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=t=>e.$router.go(-1))},[(0,a.Wm)(d,{icon:"back"})])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,n.C_)({"profile-info":!!e.subline})},[(0,a.WI)(e.$slots,"default",{},(()=>[(0,a._)("h2",null,(0,n.zw)(e.$t(e.title||e.titleFromRoute()||"Home")),1),e.subline?((0,a.wg)(),(0,a.iD)("span",o,(0,n.zw)(e.subline),1)):(0,a.kq)("",!0)]))],2),(0,a._)("div",r,[(0,a.WI)(e.$slots,"addon")])],2)}var c=s(7664);const p=(0,a.aZ)({name:"PageHeader",components:{BaseIcon:c.Z},props:{title:{type:String,default:void 0},subline:{type:String,default:void 0},backButton:{type:Boolean,default:!1},logo:{type:Boolean,default:!1},dense:{type:Boolean,default:!1}},methods:{titleFromRoute(){const e=this.$route.name?.toLowerCase();return e?.charAt(0).toUpperCase()+e?.substring(1)}}});var d=s(1639);const l=(0,d.Z)(p,[["render",i]]),u=l},9288:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var a=s(9835),n=s(6970);const o={class:"messages"},r={key:0};function i(e,t,s,i,c,p){const d=(0,a.up)("q-menu"),l=(0,a.up)("q-btn"),u=(0,a.up)("PageHeader"),m=(0,a.up)("ConversationItem"),g=(0,a.up)("BaseIcon"),v=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(u,{"back-button":""},{addon:(0,a.w5)((()=>[(0,a.Wm)(l,{icon:"more_vert",size:"md",round:"",flat:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{anchor:"bottom right",self:"top right",offset:[0,6],class:"options-popup"},{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.iD)("a",{onClick:t[0]||(t[0]=(...e)=>p.markAllAsRead&&p.markAllAsRead(...e))},[(0,a.Uk)((0,n.zw)(e.$t("Mark all as read")),1)])),[[v]])])),_:1})])),_:1})])),_:1}),(0,a._)("div",o,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p.conversations,(e=>((0,a.wg)(),(0,a.j4)(m,{key:e.pubkey,conversation:e},null,8,["conversation"])))),128)),p.conversations?.length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("p",r,[(0,a.Uk)((0,n.zw)(e.$t("To send a message, click on the"))+" ",1),(0,a.Wm)(g,{icon:"messages"}),(0,a.Uk)(" "+(0,n.zw)(e.$t("icon in the recipient's profile.")),1)]))])],64)}var c=s(9010),p=s(3099),d=s(6166),l=s(3413);const u={class:"conversation-item-avatar"},m={class:"conversation-item-content"},g={class:"username"},v={key:0,class:"message"},y={class:"conversation-item-info"},h={key:0,class:"created-at"};function k(e,t,s,o,r,i){const c=(0,a.up)("UserAvatar"),p=(0,a.up)("UserName"),d=(0,a.up)("EncryptedMessage"),l=(0,a.up)("q-badge");return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["conversation-item",{"has-unread":s.conversation.numUnread}]),onClick:t[0]||(t[0]=e=>i.goToConversation())},[(0,a._)("div",u,[(0,a.Wm)(c,{pubkey:s.conversation.pubkey},null,8,["pubkey"])]),(0,a._)("div",m,[(0,a._)("div",g,[(0,a.Wm)(p,{pubkey:s.conversation.pubkey,"show-verified":""},null,8,["pubkey"])]),s.conversation.latestMessage?((0,a.wg)(),(0,a.iD)("div",v,[(0,a.Wm)(d,{message:s.conversation.latestMessage},null,8,["message"])])):(0,a.kq)("",!0)]),(0,a._)("div",y,[s.conversation.latestMessage?((0,a.wg)(),(0,a.iD)("div",h,(0,n.zw)(i.createdAt),1)):(0,a.kq)("",!0),s.conversation.numUnread?((0,a.wg)(),(0,a.j4)(l,{key:1,label:s.conversation.numUnread,color:"primary",class:"unreads",rounded:""},null,8,["label"])):(0,a.kq)("",!0)])],2)}s(9665);var b=s(5501),w=s(9715),f=s(528),_=s(2296),C=s(4520);const Z={name:"ConversationItem",components:{EncryptedMessage:f.Z,UserName:w.Z,UserAvatar:b.Z},props:{conversation:{type:Object,required:!0}},computed:{createdAt(){if(!this.conversation.latestMessage)return;const e=this.$q.screen.lt.md?"short":"long";return _.Z.formatFromNow(this.conversation.latestMessage.createdAt,e)}},methods:{goToConversation(){this.$router.push({name:"conversation",params:{pubkey:(0,C.jm)(this.conversation.pubkey,"npub")}})}}};var D=s(1639),A=s(990),q=s(9984),I=s.n(q);const M=(0,D.Z)(Z,[["render",k],["__scopeId","data-v-87a71a02"]]),W=M;I()(Z,"components",{QBadge:A.Z});var $=s(7664);const B={name:"Messages",components:{BaseIcon:$.Z,ConversationItem:W,PageHeader:c.Z},setup(){return{app:(0,p.q)(),nostr:(0,d.D)(),messages:(0,l.G)()}},computed:{conversations(){return this.app.isSignedIn?this.messages.getConversations(this.app.myPubkey):[]}},methods:{markAllAsRead(){this.messages.markAllAsRead(this.app.myPubkey)}}};var F=s(8879),U=s(6362),P=s(2146);const z=(0,D.Z)(B,[["render",i],["__scopeId","data-v-0112f406"]]),R=z;I()(B,"components",{QBtn:F.Z,QMenu:U.Z}),I()(B,"directives",{ClosePopup:P.Z})}}]);